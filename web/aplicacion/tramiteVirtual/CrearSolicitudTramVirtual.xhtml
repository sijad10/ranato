<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui" >
    <ui:composition template="/template.xhtml"> 
        <ui:define name="title">
            <h:outputText value="Crear Solicitud de Trámite Virtual" />
        </ui:define>
        <ui:define name="body">
            <style>
                body .ui-accordion .ui-accordion-header.ui-state-active {
                    border: 1px solid #1F89CE;
                    background-color: #1F89CE;
                    color: #fff;
                }
                body .ui-steps * {
                    box-sizing: border-box;
                }
                body .ui-steps {
                    padding: 0 30px;
                    background: #dedede;
                    margin-bottom: 10px;
                }
                body .ui-steps .ui-steps-item {
                    background-color: transparent;
                    text-align: center;
                    opacity: 1;
                    filter: alpha(opacity=100);
                    border: none;
                    /*margin-right: 10%;*/
                    display: inline-block;
                    position: relative;
                    width: 25%;/*ancho de cada step*/
                }
                body .ui-steps:before {
                    /*content: ' ';*/
                    border-top: 1px solid #3949AB;
                    width: 100%;
                    top: 14%;
                    left: 0;
                    display: block;
                    position: absolute;
                }
                body .ui-state-highlight {
                    text-shadow: none !important;
                }
                .ui-steps-item:before {
                    content: "";
                    display: block;
                    position: absolute;
                    /*left: 100%;*/
                    width: 100%;
                    /*left: 63%
                    width: 75%
                    */
                    height: 2px;
                    border-top: 3px solid #0085ca;
                    top: 32px;
                }
                body .ui-steps .ui-steps-item .ui-menuitem-link {
                    display: inline-block;
                    text-align: center;
                    background-color: transparent;
                    overflow: hidden;
                }

                body .ui-steps .ui-steps-item .ui-menuitem-link .ui-steps-number {
                    -moz-border-radius: 50%;
                    -webkit-border-radius: 50%;
                    border-radius: 50%;
                    display: inline-block;
                    color: #333;
                    background-color: #fff;
                    border: 2px solid #c3c3c3;
                    position: relative;
                    top: 14px;
                    margin-bottom: 14px;
                    width: 2em;
                    height: 2em;
                    font-size: 16px;
                    padding-top: .4em;
                    text-align: center;
                    font-size: large;
                }

                body .ui-steps .ui-steps-item.ui-state-highlight .ui-steps-number {
                    background: #0085ca;
                    color: #fff;
                    border: 2px solid #0085ca;
                }
                body .ui-steps .ui-steps-item.ui-state-highlight {
                    /*border: 1px solid graytext;*/
                }

                body .ui-steps .ui-steps-item .ui-menuitem-link {
                    display: inline-block;
                    text-align: center;
                    background-color: transparent;
                    overflow: hidden;
                    padding: 0;
                }
                body .ui-steps .ui-steps-item.ui-state-highlight .ui-steps-title {
                    font-weight: 700;
                    color: #333;
                }
                body .ui-steps .ui-steps-item .ui-menuitem-link .ui-steps-title {
                    display: block;
                    margin-top: 6px;
                    white-space: normal;
                    /*color: #737373;*/
                }
            </style>
            <div class="ui-fluid">
                <div class="ui-g">
                    <div class="ui-g-12">

                        <h:form id="createForm">
                            <p:steps id="steps" activeIndex="0"  >
                                <p:menuitem value="Registrar solicitud y Guardar" />
                                <p:menuitem value="Presentar solicitud" />
                                <p:menuitem value="Generación de expediente" />
                                <p:menuitem value="En evaluación" />
                            </p:steps>
                            <p:panel id="solicitanteTutorial" header="Tutorial del sistema" style="margin-bottom:10px;" toggleable="true" toggleSpeed="500" toggleTitle="Expandir" widgetVar="panel0" >
                                <p:link target="_blank"  href="#{tramiteVirtualController.linkTutorial}" >
                                        <p:graphicImage name="/icons/youtube_icon.png" width="23" />
                                        <p:outputLabel value="Video guía para registrar una solicitud en Ventanilla Virtual" style="margin-left: 5px;" />
                                   </p:link>
                            </p:panel>
                            <p:panel id="solicitantePanel" header="Datos del Solicitante" style="margin-bottom:10px;" toggleable="true" toggleSpeed="500" toggleTitle="Expandir" widgetVar="panel1" >
                                <div class="ui-g">
                                    <div class="ui-g-12 ui-md-3 ui-lg-3">
                                        <p:outputLabel value="Administrado: "/>
                                    </div>
                                    <div class="ui-g-12 ui-md-9 ui-lg-9">
                                        <p:outputLabel value="#{tramiteVirtualController.getDocumentoRznSocApeNombresCompleto()}" style="font-weight: bold;"/>
                                    </div>
                                </div>
                                <p:outputPanel rendered="#{tramiteVirtualController.personaLogeada.tipoId.codProg eq 'TP_PER_JUR' and !tramiteVirtualController.renderPanelNuevoRep}">
                                    <div class="ui-g">
                                        <div class="ui-g-12 ui-md-3 ui-lg-3">
                                            <p:outputLabel value="Representante Legal: "/>
                                        </div>
                                        <div class="ui-g-12 ui-md-6 ui-lg-6">
                                            <p:selectOneMenu id="repLegalId" value="#{tramiteVirtualController.registro.representanteLegalId}" filter="true" 
                                                             effect="fade" filterMatchMode="contains" autoWidth="false">
                                                <f:selectItem itemLabel="[ SELECCIONE ]" itemValue="#{null}"/>
                                                <f:selectItems value="#{tramiteVirtualController.listarRepresentante()}" 
                                                               var="representante" itemLabel="#{representante.tipoDoc.nombre} : #{representante.numDoc} - #{representante.apellidosyNombres}"
                                                               itemValue="#{representante}"/>
                                            </p:selectOneMenu>
                                        </div>
                                        <div class="ui-g-12 ui-md-3 ui-lg-3">
                                            <p:commandButton value="Indicar nuevo representante"
                                                             id="btnBuscarNuevoRepLegal"
                                                             process="@this"
                                                             actionListener="#{tramiteVirtualController.mostrarPanelNuevoRepLegal()}"
                                                             update="@form"/>
                                        </div>
                                    </div>
                                </p:outputPanel>
                                <p:outputPanel id="panelRepLegal" rendered="#{tramiteVirtualController.renderPanelNuevoRep}">
                                    <div class="ui-g">
                                        <div class="ui-g-12 ui-md-3 ui-lg-3">
                                            <p:outputLabel value="Nuevo Representante Legal: "/>
                                        </div>
                                        <div class="ui-g-5 ui-md-2 ui-lg-2">
                                            <p:selectOneMenu id="tipoDocumento" autoWidth="false"
                                                             value="#{tramiteVirtualController.registro.tipoDocNuevoRepLegalId}" >
                                                <f:selectItem itemLabel="[ SELECCIONE ]" itemValue="#{null}"/>
                                                <f:selectItems var="item" itemValue="#{item}" itemLabel="#{item.nombre}"
                                                               value="#{tramiteVirtualController.tipoDocumentosSolicitante }"/>
                                                <p:ajax event="change" process="panelRepLegal" update="@this,panelRepLegal" 
                                                        listener="#{tramiteVirtualController.cambiaTipoDocumentoRepLegal()}" />
                                            </p:selectOneMenu>
                                        </div>
                                        <div class="ui-g-7 ui-md-4 ui-lg-4">
                                            <p:inputText id="numDocNuevoRepLegal" value="#{tramiteVirtualController.registro.documentoNuevoRepLegal}" 
                                                         maxlength="#{tramiteVirtualController.maxLengthDoc}" >
                                                <p:keyFilter regEx="/[0-9]/i" preventPaste="false" />
                                                <p:ajax event="blur" update="panelRepLegal" listener="#{tramiteVirtualController.buscarPersonaRepLegal()}" />
                                            </p:inputText>
                                        </div>
                                        <div class="ui-g-12 ui-md-3 ui-lg-3">
                                            <p:commandButton value="Seleccionar representante de la lista"
                                                             id="btnOcultarNuevoRepLegal"
                                                             process="@this"
                                                             actionListener="#{tramiteVirtualController.ocultarPanelNuevoRepLegal()}"
                                                             update="@form"/>
                                        </div>
                                    </div>
                                </p:outputPanel>
                                <div class="ui-g">
                                    <div class="ui-g-12 ui-md-3 ui-lg-3">
                                        <p:outputLabel value="Dirección: " for="direccionId"/>
                                    </div>
                                    <div class="ui-g-12 ui-md-9 ui-lg-9">
                                        <p:inputText id="direccionId" value="#{tramiteVirtualController.registro.direccion}"
                                                     required="true" requiredMessage="Falta ingresar la dirección"/>
                                    </div>
                                </div>                              
                                <div class="ui-g">
                                    <div class="ui-g-12 ui-md-3 ui-lg-3">
                                        <p:outputLabel value="Departamento / Provincia / Distrito: " for="pId"/>
                                    </div>
                                    <div class="ui-g-12 ui-md-9 ui-lg-7">
                                        <p:selectOneMenu id="pId" value="#{tramiteVirtualController.registro.ubigeoDireccionId}" filter="true" 
                                                         effect="fade" filterMatchMode="contains" autoWidth="false"
                                                         required="true" requiredMessage="Falta seleccionar la ubicación geográfica">
                                            <f:selectItem itemLabel="[ SELECCIONE ]" itemValue="#{null}"/>
                                            <f:selectItems value="#{tramiteVirtualController.listDistritos}" 
                                                           var="distrito" itemLabel="#{distrito.nombreCompleto}"
                                                           itemValue="#{distrito}"/>
                                        </p:selectOneMenu>
                                    </div>
                                </div>
                                <div class="ui-g">
                                    <div class="ui-g-12 ui-md-3 ui-lg-3">
                                        <p:outputLabel value="Medio de Contacto: "/>
                                    </div>
                                    <div class="ui-g-5 ui-md-3 ui-lg-3">
                                        <p:selectOneMenu value="#{tramiteVirtualController.registro.tipoMedioContactoId}" autoWidth="false" >
                                            <f:selectItem itemLabel="[ SELECCIONE ]" itemValue="#{null}"/>
                                            <f:selectItems value="#{tramiteVirtualController.listTipoTelefonoContacto}"
                                                           var="TP_MEDCON" itemLabel="#{TP_MEDCON.nombre}" 
                                                           itemValue="#{TP_MEDCON}"/>
                                        </p:selectOneMenu>
                                    </div>
                                    <div class="ui-g-7 ui-md-6 ui-lg-6">
                                        <p:inputText value="#{tramiteVirtualController.registro.telefonoContacto}"/>
                                    </div>
                                </div>
                                <div class="ui-g">
                                    <div class="ui-g-12 ui-md-3 ui-lg-3">
                                        <p:outputLabel value="Correo Electrónico: " for="correoId"/>
                                    </div>
                                    <div class="ui-g-5 ui-md-3 ui-lg-3">
                                        <p:inputText id="correoId" value="#{tramiteVirtualController.registro.correo}"
                                                     required="true" requiredMessage="Falta ingresar la correo"/>
                                    </div>
                                </div>  
                            </p:panel>

                            <p:panel id="procTupaPanel" header="Procedimiento o Servicio prestado en exclusividad del TUPA" style="margin-bottom:10px;" toggleable="true" toggleSpeed="500" widgetVar="panel2" >
                                <div class="ui-g">
                                    <div class="ui-g-3">                                        
                                        <p:outputLabel value="Buscar procedimiento: "/>
                                    </div>
                                    <div class="ui-g-6">
                                        <p:inputText value="#{tramiteVirtualController.procedimientoFiltro}" placeholder="POR CODIGO O DENOMINACION TUPA POR EJEMPLO: PA34000D6B o Manipulación de explosivos"/>
                                    </div>
                                    <div class="ui-g-3">
                                        <p:commandButton value="Buscar" id="botonBuscarProc"
                                                         process="@this, procTupaPanel, @form"
                                                         icon="ui-icon-search" actionListener="#{tramiteVirtualController.buscarProcedimiento()}"
                                                         update="buscarDatatableProcedimiento,procTupaPanel,empocePanel,requisitosPanel,@form"/>
                                    </div>
                                    <div class="ui-g-12">
                                        <p:outputLabel style="font-size: 95%!important;" rendered="#{tramiteVirtualController.renderTablaProcedimiento}"
                                                       value="Nota: En caso del canal VUCE, ingresar a la página de la plataforma VUCE, en caso de MESA DE PARTES acercarse a cualquiera de los centros de atención de la SUCAMEC"/>
                                    </div>
                                </div>


                                <p:dataTable id="buscarDatatableProcedimiento" value="#{tramiteVirtualController.tupaLst}"
                                             var="itemReg" 
                                             emptyMessage="#{bundleCitas.MensajeNoResultados}" 
                                             paginator="true" rows="#{bundleCitas.PaginatorFilas}"  
                                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"  
                                             rowsPerPageTemplate="#{bundleCitas.PaginatorFilasPorPagina}"
                                             rowIndexVar="idExp"
                                             reflow="true"
                                             rendered="#{tramiteVirtualController.renderTablaProcedimiento}"
                                             >
                                    <p:column headerText="Procedimiento o Servicio TUPA" style="font-size:95%!important" class="ui-lg-6" >
                                        <h:outputText value="#{itemReg.tupaProcedimientoId.nombre}"/>
                                    </p:column>
                                    <p:column headerText="Derecho (S/.)" style="font-size:95%!important;text-align: center;" class="ui-lg-1">
                                        <h:outputText value="#{itemReg.importe}" rendered="#{tramiteVirtualController.mostrarBuscarEmpoce(itemReg)}" />
                                        <h:outputText value="GRATUITO" rendered="#{!tramiteVirtualController.mostrarBuscarEmpoce(itemReg)}" />
                                    </p:column>
                                    <p:column headerText="Plazo" style="font-size:95%!important" class="ui-lg-2" >
                                        <h:outputText value="LIMA: #{itemReg.plazoLimaDias} DÍAS"/><br/>
                                        <h:outputText value="PROVINCIA: #{itemReg.plazoProvinciaDias} DÍAS"/><br/>
                                    </p:column>
                                    <p:column headerText="Canal Atención" style="font-size:95%!important" class="ui-lg-2" >
                                        <h:outputText value="#{itemReg.canalAtencionId.nombre}" />
                                    </p:column>
                                    <p:column headerText="Opciones" style="font-size:95%!important" class="ui-lg-2" >
                                        <p:commandButton action="#{tramiteVirtualController.seleccionarProcedimiento(itemReg)}" 
                                                         value="Seleccionar" oncomplete="PF('panel1').slideUp();"
                                                         rendered = "#{itemReg.canalAtencionId.codProg eq 'TP_CAEXPVIR_TV'}"
                                                         partialSubmit="true" process="@form,buscarDatatableProcedimiento, @this" update="@form" />
                                    </p:column>
                                </p:dataTable>

                                <p:outputPanel rendered="#{tramiteVirtualController.tupaSelected != null}" class="ui-panel ui-widget-content ui-corner-all">
                                    <div class="ui-g">
                                        <div class="ui-g-12 ui-md-3 ui-lg-3" >
                                            <p:outputLabel value="Procedimiento o Servicio TUPA: "/>
                                        </div>
                                        <div class="ui-g-12 ui-md-9 ui-lg-9" >
                                            <p:outputLabel value="#{tramiteVirtualController.tupaSelected.tupaProcedimientoId.nombre}" style="font-weight: bold; font-size:1.2em!important;"/>
                                        </div>
                                    </div>
                                    <div class="ui-g">
                                        <div class="ui-g-12 ui-md-3 ui-lg-3" >
                                            <p:outputLabel value="Derecho Trámite (S/.): "/>
                                        </div>
                                        <div class="ui-g-12 ui-md-3 ui-lg-3" >
                                            <p:outputLabel value="#{tramiteVirtualController.tupaSelected.importe}" style="font-weight: bold; font-size:1.2em!important;" rendered="#{tramiteVirtualController.visiblePanelEmpoce}"/>
                                            <p:outputLabel value="GRATUITO" style="font-weight: bold; font-size:1.2em!important;" rendered="#{!tramiteVirtualController.visiblePanelEmpoce}"/>
                                        </div>
                                        <div class="ui-g-12 ui-md-3 ui-lg-3" >
                                            <p:outputLabel value="Canal: "/>
                                        </div>
                                        <div class="ui-g-12 ui-md-3 ui-lg-3" >
                                            <p:outputLabel value="#{tramiteVirtualController.tupaSelected.canalAtencionId.nombre}" style="font-weight: bold; font-size:1.2em!important;"/>
                                        </div>
                                    </div>
                                    <div class="ui-g">
                                        <div class="ui-g-12 ui-md-3 ui-lg-3" >
                                            <p:outputLabel value="Área: "/>
                                        </div>
                                        <div class="ui-g-12 ui-md-3 ui-lg-3" >
                                            <p:outputLabel value="#{tramiteVirtualController.tupaSelected.areaId.nombre}" style="font-weight: bold; "/>
                                        </div>
                                        <div class="ui-g-12 ui-md-3 ui-lg-3" >
                                            <p:outputLabel value="Plazo: "/>
                                        </div>
                                        <div class="ui-g-12 ui-md-3 ui-lg-3" >
                                            <p:outputLabel value="LIMA: #{tramiteVirtualController.tupaSelected.plazoLimaDias} DIAS y PROVINCIA: #{tramiteVirtualController.tupaSelected.plazoProvinciaDias} DIAS" style="font-weight: bold; "/>
                                        </div>
                                    </div>
                                </p:outputPanel>
                            </p:panel>
                            <p:panel id="personaRefPanel" header="Persona Natural a la que se solicita el trámite" style="margin-bottom:10px;" toggleable="true" toggleSpeed="500" widgetVar="panelPersonaRef" rendered="#{tramiteVirtualController.visiblePanelPersonaRef}">
                                <div class="ui-g">
                                    <div class="ui-g-12 ui-md-3 ui-lg-3">
                                        <p:outputLabel value="Tipo y Nro. Documento: "/>
                                    </div>
                                    <div class="ui-g-5 ui-md-3 ui-lg-2">
                                        <p:selectOneMenu id="tipoDocumentoPerRef" autoWidth="false"
                                                         value="#{tramiteVirtualController.registro.tipoDocRefPersonaId}" >
                                            <f:selectItem itemLabel="[ SELECCIONE ]" itemValue="#{null}"/>
                                            <f:selectItems var="item" itemValue="#{item}" itemLabel="#{item.nombre}"
                                                           value="#{tramiteVirtualController.tipoDocumentosSolicitante }"/>
                                            <p:ajax event="change" process="personaRefPanel" update="@this,personaRefPanel,empocePanel" 
                                                    listener="#{tramiteVirtualController.cambiaTipoDocumentoPersonaRef()}" />
                                        </p:selectOneMenu>
                                    </div>
                                    <div class="ui-g-7 ui-md-6 ui-lg-5">
                                        <p:inputText id="numDocPerRef" value="#{tramiteVirtualController.registro.documentoRefPersona}" 
                                                     maxlength="#{tramiteVirtualController.maxLengthDocPerRef}" >
                                            <p:keyFilter regEx="/[0-9]/i" preventPaste="false" />
                                            <p:ajax event="blur" update="personaRefPanel,empocePanel" listener="#{tramiteVirtualController.buscarPersonaRef()}" />
                                        </p:inputText>
                                    </div>                                    
                                </div>
                                <div class="ui-g">
                                    <div class="ui-g-12 ui-md-3 ui-lg-3">
                                        <p:outputLabel value="Apellido Paterno: "/>
                                    </div>
                                    <div class="ui-g-12 ui-md-6 ui-lg-6">
                                        <p:inputText id="ApePatPerRef" value="#{tramiteVirtualController.registro.apePatRefPersona}" placeholder="Escriba el apellido paterno de la persona"/>
                                    </div>
                                </div>
                                <div class="ui-g">
                                    <div class="ui-g-12 ui-md-3 ui-lg-3">
                                        <p:outputLabel value="Apellido Materno: "/>
                                    </div>
                                    <div class="ui-g-12 ui-md-6 ui-lg-6">
                                        <p:inputText id="ApeMatPerRef" value="#{tramiteVirtualController.registro.apeMatRefPersona}" placeholder="Escriba el apellido materno de la persona"/>
                                    </div>
                                </div>
                                <div class="ui-g">
                                    <div class="ui-g-12 ui-md-3 ui-lg-3">
                                        <p:outputLabel value="Nombres: "/>
                                    </div>
                                    <div class="ui-g-12 ui-md-6 ui-lg-6">
                                        <p:inputText id="nombresPerRef" value="#{tramiteVirtualController.registro.nombresRefPersona}" placeholder="Escriba el nombre de la persona"/>
                                    </div>
                                </div>
                            </p:panel>                                
                            <p:panel id="empocePanel" header="Empoce Bancario" style="margin-bottom:10px;" toggleable="true" toggleSpeed="500" widgetVar="panel3" rendered="#{tramiteVirtualController.visiblePanelEmpoce}">
                                <div class="ui-g">
                                    <div class="ui-g-12">                                        
                                        <p:outputLabel value="Nota: Recuerde ingresar el número de empoce que figure a nombre de la Persona a la que se solicita el trámite" style="color: #0085CA; font-weight: bold;" rendered="#{tramiteVirtualController.solicitarReciboSoloPersonaRef(tramiteVirtualController.tupaSelected) and tramiteVirtualController.reciboSelected == null}"/>
                                        <p:outputLabel value="Nota: Recuerde ingresar el número de empoce que figure a su nombre o a nombre de la Persona a la que se solicita el trámite" style="color: #0085CA; font-weight: bold;" rendered="#{tramiteVirtualController.solicitarReciboPersonaRefYSolicitante(tramiteVirtualController.tupaSelected) and tramiteVirtualController.reciboSelected == null}"/>
                                    </div>
                                </div>
                                <div class="ui-g">
                                    <div class="ui-g-3">                                        
                                        <p:outputLabel value="Buscar recibo: "/>
                                    </div>
                                    <div class="ui-g-6">
                                        <p:inputText value="#{tramiteVirtualController.empoceFiltro}" placeholder="Escriba el número completo y presione BUSCAR"/>
                                    </div>
                                    <div class="ui-g-3">
                                        <p:commandButton value="Buscar" id="botonBuscarEmpoce"
                                                         process="@this, empocePanel,personaRefPanel"
                                                         icon="ui-icon-search" actionListener="#{tramiteVirtualController.buscarEmpoce()}"
                                                         update="buscarDatatableEmpoce,empocePanel,personaRefPanel"/>
                                    </div>
                                </div>
                                <p:outputPanel rendered="#{tramiteVirtualController.mensajeErrorEmpoce != null}" class="ui-panel ui-widget-content ui-corner-all">
                                    <div class="ui-g">
                                        <div class="ui-g-12 ui-md-12 ui-lg-12" >
                                            <p:outputLabel value="#{tramiteVirtualController.mensajeErrorEmpoce}" style="color: #e0263b; font-weight: bold; font-size:1.2em!important;"/>
                                        </div>
                                    </div>
                                </p:outputPanel>

                                <p:dataTable id="buscarDatatableEmpoce" value="#{tramiteVirtualController.recibosLst}"
                                             var="itemReg" 
                                             emptyMessage="#{bundleCitas.MensajeNoResultados}" 
                                             paginator="true" rows="#{bundleCitas.PaginatorFilas}"  
                                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"  
                                             rowsPerPageTemplate="#{bundleCitas.PaginatorFilasPorPagina}"
                                             rowIndexVar="idExp"
                                             reflow="true"
                                             rendered="#{tramiteVirtualController.reciboSelected == null and tramiteVirtualController.mensajeErrorEmpoce == null and tramiteVirtualController.recibosLst.size()>0 }"
                                             >

                                    <p:column headerText="RUC/DNI/CE" style="font-size:95%!important" class="ui-lg-3" >
                                        <h:outputText value="#{itemReg.nroDocumento}"/>
                                    </p:column>
                                    <p:column headerText="Nro. Empoce" style="font-size:95%!important" class="ui-lg-2" >
                                        <h:outputText value="#{itemReg.nroSecuencia}"/>
                                    </p:column>
                                    <p:column headerText="Monto pagado" style="font-size:95%!important" class="ui-lg-2">
                                        <h:outputText value="#{itemReg.importe}" />
                                    </p:column>
                                    <p:column headerText="Fecha" style="font-size:95%!important" class="ui-lg-2" >
                                        <h:outputText value="#{itemReg.fechaMovimiento}">
                                            <f:convertDateTime pattern="#{bundleCitas.FormatoFecha}" />
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Opciones" style="font-size:95%!important" class="ui-lg-2" >
                                        <p:commandButton action="#{tramiteVirtualController.seleccionarEmpoce(itemReg)}" 
                                                         value="Seleccionar" oncomplete="PF('panel1').slideUp();PF('panel2').slideUp();PF('panel3').slideUp();"
                                                         partialSubmit="true" process="buscarDatatableEmpoce, @this" update="@form" />
                                    </p:column>
                                </p:dataTable>

                                <p:outputPanel rendered="#{tramiteVirtualController.reciboSelected != null}" class="ui-panel ui-widget-content ui-corner-all">
                                    <div class="ui-g">
                                        <div class="ui-g-3" >
                                            <p:outputLabel value="Nro. Empoce: "/>
                                        </div>
                                        <div class="ui-g-3" >
                                            <p:outputLabel value="#{tramiteVirtualController.reciboSelected.nroSecuencia}" style="font-weight: bold;font-size:1.2em!important;"/>
                                        </div>
                                        <div class="ui-g-3" >
                                            <p:outputLabel value="Monto Pagado: "/>
                                        </div>
                                        <div class="ui-g-3" >
                                            <p:outputLabel value="#{tramiteVirtualController.reciboSelected.importe}" style="font-weight: bold;"/>
                                        </div>
                                        <div class="ui-g-3" >
                                            <p:outputLabel value="RUC / DNI / CE: "/>
                                        </div>
                                        <div class="ui-g-3" >
                                            <p:outputLabel value="#{tramiteVirtualController.reciboSelected.nroDocumento}" style="font-weight: bold;"/>
                                        </div>
                                        <div class="ui-g-3" >
                                            <p:outputLabel value="Fecha: "/>
                                        </div>
                                        <div class="ui-g-3" >
                                            <p:outputLabel value="#{tramiteVirtualController.reciboSelected.fechaMovimiento}" style="font-weight: bold;">
                                                <f:convertDateTime pattern="#{bundleCitas.FormatoFecha}" />
                                            </p:outputLabel>
                                        </div>
                                        <ui:remove>
                                            <div class="ui-g-12" >
                                                <p:outputLabel style="color: #42BB34" value="El empoce seleccionado corresponde con el procedimiento TUPA seleccionado y está disponible"/>
                                                <p:outputLabel style="color: #CB6470" value="#{tramiteVirtualController.mensajeErrorEmpoce}"/>
                                            </div>
                                        </ui:remove>
                                    </div>
                                </p:outputPanel>
                            </p:panel>

                            <p:panel id="sedePanel" header="Sede SUCAMEC" style="margin-bottom:10px;" toggleable="true" toggleSpeed="500" widgetVar="panelSede" rendered="#{tramiteVirtualController.tupaSelected != null}">
                                <div class="ui-g">
                                    <div class="ui-g-12 ui-md-3 ui-lg-3">
                                        <p:outputLabel value="Sede a realizar trámite: "/>
                                        <p:outputLabel value="#{tramiteVirtualController.mensajeAvisoSede}" style="color: red; font-weight: bold;"/>
                                    </div>
                                    <div class="ui-g-12 ui-md-9 ui-lg-7">
                                        <p:selectOneMenu value="#{tramiteVirtualController.registro.sedeSucamecId}" autoWidth="false" >
                                            <f:selectItem itemLabel="-----" itemValue="#{null}"/>
                                            <f:selectItems value="#{tramiteVirtualController.listarSedeSucamec()}"
                                                           var="TP_SEDE" itemLabel="#{TP_SEDE.nombre}" 
                                                           itemValue="#{TP_SEDE}"/>
                                        </p:selectOneMenu>
                                    </div>
                                </div>
                            </p:panel>

                            <p:panel id="requisitosPanel" header="Requisitos" style="margin-bottom:10px;" toggleable="true" toggleSpeed="500" widgetVar="panel4" rendered="#{tramiteVirtualController.visiblePanelRequisitos}">
                                <div class="ui-g">
                                    <div class="ui-g-12 ui-md-6 ui-lg-5">
                                        <p:outputLabel value="Para consultar la información de los requisitos, consulte el siguiente botón: " style="font-weight: bold;" rendered="#{tramiteVirtualController.tupaSelected.visibleEnlacePropio eq 1}" />
                                        <p:outputLabel value="Para consultar la información de los requisitos, consulte el siguiente enlace: " style="font-weight: bold;" rendered="#{tramiteVirtualController.tupaSelected.visibleEnlacePropio eq 0}" />
                                    </div>
                                    <div class="ui-g-12 ui-md-4 ui-lg-2">
                                        <p:commandButton icon="ui-icon-print" value="REQUISITOS"
                                                         ajax="false"
                                                         process="@this" 
                                                         partialSubmit="true"                              
                                                         onclick="this.form.target = '_blank'" 
                                                         onblur="this.form.target = '_self'"
                                                         rendered="#{tramiteVirtualController.tupaSelected.visibleEnlacePropio eq 1}"
                                                         immediate="true" >
                                            <p:fileDownload value="#{tramiteVirtualController.descargarFormato(tramiteVirtualController.tupaSelected.tupaProcedimientoId.codProg.substring(8).concat('.pdf'))}" contentDisposition="inline" />
                                            <!-- tramiteVirtualController.descargarFormato(tramiteVirtualController.tupaSelected.tupaProcedimientoId.codProg.substring(8).concat('.pdf'))  -->
                                        </p:commandButton> 
                                        <p:link target="_blank" href="https://www.sucamec.gob.pe/web/IMAGENES/2019/pdfs/tupa2018.pdf" style="font-weight: bold;" rendered="#{tramiteVirtualController.tupaSelected.visibleEnlacePropio eq 0}" >TUPA 2022</p:link>
                                    </div>
                                    <div class="ui-g-12">                                        
                                        <p:outputLabel value="Por favor complete la información para cada requisito: "/>
                                    </div>
                                    <div class="ui-g-12">   
                                        <p:accordionPanel value="#{tramiteVirtualController.expVirtualRequisitoLst}" var="req">
                                            <p:tab title="REQUISITO : #{req.tupaRequisitoId.descripcion}" >
                                                <h:panelGrid columns="2" cellpadding="5" style="border:1px solid #aaa;">                
                                                    <h:outputText value="Descripción: "/>
                                                    <h:outputText value="#{req.tupaRequisitoId.descripcion}" style="font-weight: bold;" />
                                                    <h:outputText value="" rendered="#{req.tupaRequisitoId.condicionVisibleEnlace eq 1 and tramiteVirtualController.tupaSelected.visibleEnlacePropio eq 1}"/>
                                                    <p:commandButton icon="ui-icon-print" value="VER DETALLE DE REQUISITOS"
                                                                     ajax="false"
                                                                     process="@this" 
                                                                     partialSubmit="true"                              
                                                                     onclick="this.form.target = '_blank'" 
                                                                     onblur="this.form.target = '_self'"
                                                                     rendered="#{req.tupaRequisitoId.condicionVisibleEnlace eq 1 and tramiteVirtualController.tupaSelected.visibleEnlacePropio eq 1}"
                                                                     style="width: 220px;"
                                                                     immediate="true" >
                                                        <p:fileDownload value="#{tramiteVirtualController.descargarFormato(tramiteVirtualController.tupaSelected.tupaProcedimientoId.codProg.substring(8).concat('.pdf'))}" contentDisposition="inline" />
                                                    </p:commandButton>
                                                    <p:link target="_blank" href="https://www.sucamec.gob.pe/web/IMAGENES/2019/pdfs/tupa2018.pdf" style="font-weight: bold;" rendered="#{req.tupaRequisitoId.condicionVisibleEnlace eq 1 and tramiteVirtualController.tupaSelected.visibleEnlacePropio eq 0}">VER DETALLE DE REQUISITOS</p:link>

                                                    <h:outputText value="Condición: "/>
                                                    <h:outputText value="#{tramiteVirtualController.condicionStr(req.tupaRequisitoId.condicionPresentacion)}" />

                                                    <h:outputText value="Formatos: " rendered="#{req.tupaRequisitoId.condicionFormatoDescarga == 1}"/>
                                                    <h:panelGrid columns="2" cellpadding="5" rendered="#{req.tupaRequisitoId.condicionFormatoDescarga == 1}">                                                      
                                                        <h:outputText value="Pulse para descargar: " rendered="#{req.tupaRequisitoId.condicionFormatoDescarga == 1}"/>
                                                        <p:repeat value="#{req.tupaRequisitoId.tipoBaseList}" var="formato"
                                                                  size="#{req.tupaRequisitoId.tipoBaseList.size()}" step="1" offset="0" varStatus="estado"
                                                                  rendered="#{req.tupaRequisitoId.condicionFormatoDescarga == 1}">
                                                            <p:link target="_blank" href="#{formato.descripcion}" >#{formato.nombre}</p:link>
                                                            &nbsp;&nbsp;
                                                        </p:repeat>
                                                    </h:panelGrid>

                                                    <h:outputText value="Sustento del requisito: "/>
                                                    <p:inputTextarea value="#{req.respuestaRequisito}"/>

                                                    <h:outputText value="Adjuntos: "/>
                                                    <h:panelGrid columns="2" cellpadding="5">  
                                                        <p:dataTable id="tblAdjuntos"
                                                                     style="width: 100%;"
                                                                     value="#{req.sbExpVirtualAdjuntoList}"
                                                                     emptyMessage="#{BundleBDIntegrado.MensajeNoResultados}" var="itemComp" >

                                                            <p:column headerText="Archivos Adjuntos" style="text-align:center">                                                                
                                                                <p:outputLabel value="#{itemComp.nombre}"/>
                                                            </p:column>
                                                            <p:column headerText="Opciones" style="text-align:center">
                                                                <p:commandButton value="Eliminar"
                                                                                 icon="ui-icon-closethick"
                                                                                 process="@this,:createForm:requisitosPanel" 
                                                                                 update="@this,:createForm:requisitosPanel" 
                                                                                 actionListener="#{tramiteVirtualController.eliminarAdjunto(itemComp)}">
                                                                    <p:confirm header="Confirmación" message="#{BundleBDIntegrado.ConfirmarEliminar}" ></p:confirm>
                                                                </p:commandButton>
                                                            </p:column>
                                                        </p:dataTable>

                                                        <p:fileUpload id="idAdjunto" label="Archivo"
                                                                      invalidFileMessage="Solo se permite la carga de imágenes con extensión PDF o JPG"
                                                                      invalidSizeMessage="Solo se permite subir archivos con un maximo de 500 KB."
                                                                      fileUploadListener="#{tramiteVirtualController.handleFileUploadArchivo}"
                                                                      mode="advanced" dragDropSupport="false"
                                                                      multiple="false"
                                                                      style="float:left;width: 100%;"
                                                                      process="@this,:createForm:requisitosPanel"
                                                                      auto="true" update="@this,:createForm:requisitosPanel" 
                                                                      allowTypes="/(\.|\/)(jpg|JPG|pdf|PDF)$/" immediate="false" >
                                                            <f:attribute name="origen" value="#{req}" />
                                                        </p:fileUpload>
                                                    </h:panelGrid>
                                                </h:panelGrid>
                                            </p:tab>
                                        </p:accordionPanel>
                                    </div>    
                                </div>
                            </p:panel>

                            <p:panel id="notificacionesPanel" header="Notificaciones y Alertas" style="margin-bottom:10px;" toggleable="true" toggleSpeed="500" widgetVar="panel5" rendered="#{tramiteVirtualController.visiblePanelNotificaciones}">
                                <div class="ui-g">
                                    <div class="ui-g-12">
                                        <p:selectBooleanCheckbox value="#{tramiteVirtualController.notificacionViaSelBoolean}" 
                                                                 itemLabel="Acepto recibir en mi Buzón Electrónico de la plataforma virtual SEL las notificaciones que se realicen como producto de la presente solicitud"/>
                                    </div>
                                </div>
                                <div class="ui-g">
                                    <div class="ui-g-12">
                                        <p:selectBooleanCheckbox value="#{tramiteVirtualController.notificacionAlertaCelularBoolean}"
                                                                 itemLabel="Acepto que se envíen avisos/alertas referidos al trámite solicitado al número de celular registrado en el presente formulario"/>
                                    </div>   
                                </div>
                            </p:panel>

                            <div class="ui-g">
                                <div class="ui-g-2">
                                    <p:commandButton actionListener="#{tramiteVirtualController.guardar()}"  icon="ui-icon-disk" value="Guardar" rendered="#{tramiteVirtualController.visibleGuardar}"/>
                                </div>
                                <div class="ui-g-2">
                                    <p:commandButton actionListener="#{tramiteVirtualController.regresar()}" update="@all,solicitantePanel" process="@all" immediate="true" icon="ui-icon-arrowreturn-1-w" value="Reiniciar"/>
                                </div>                                  
                            </div>

                        </h:form>
                    </div>
                </div>

            </div>
            <!-- ui include -->


        </ui:define>        
    </ui:composition>
</html>