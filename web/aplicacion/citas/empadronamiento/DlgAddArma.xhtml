<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pe="http://primefaces.org/ui/extensions"                
                xmlns:f="http://xmlns.jcp.org/jsf/core">
    <p:dialog id="dlgAddArmaEmpadrona" widgetVar="wvDlgAddArmaEmpadrona" closable="true" header="Registrar Armas y/o Municiones" 
              resizable="false" modal="true" appendTo="@(body)" onShow="showDlgAddArmaEmpadrona()" width="90%"
              position="center top"
              style="position: absolute; top: 0; bottom: 0; right: 0; left: 0; overflow-y: scroll;" >
        
        
        <h:form id="addArmaFormEmpadrona">
            <div class="ui-fluid">
                <p:focus context="addArmaFormEmpadrona" />
                
                <p:panel header="Datos de las Armas" id="panDatosArmas" style=" border-color: #2399E5"> 
                    <div class="ui-g">
                        <div class="ui-g-12 ui-md-1 ui-lg-1">   
                            <p:outputLabel value="Tipo de Internamiento"/>
                        </div>
                        <div class="ui-g-12 ui-md-4 ui-lg-4">   
                            <p:selectOneMenu id="cbModo" value="#{citasEmpadronamientoController.tipoInternamiento}">
                                <f:selectItem itemLabel="SELECCIONE" itemValue="#{null}"/>
                                <f:selectItems var="item" itemValue="#{item}" itemLabel="#{item.nombre}" 
                                               value="#{citasEmpadronamientoController.listmodo}"/>
                                <p:ajax event="change" process="@this" update="@form" listener="#{citasEmpadronamientoController.verificaVoucher()}"/>                                
                            </p:selectOneMenu> 
                        </div>
                        <div class="ui-g-12 ui-md-2 ui-lg-2">   
                            <p:outputLabel value="Tipo de Arma"/>
                        </div>
                        <div class="ui-g-12 ui-md-5 ui-lg-5">   
                            <p:selectOneMenu id="tipoArmaEmpadrona" value="#{citasEmpadronamientoController.tipoArmaEmpadromiento}">
                                <f:selectItem itemLabel="SELECCIONE" itemValue="#{null}"/>
                                <f:selectItems var="item" itemValue="#{item}" itemLabel="#{item.nombre}"
                                               value="#{citasEmpadronamientoController.obtenerTipoArmas()}"/>
                                <p:ajax event="change" partialSubmit="true" process="@this" update="tipoArmaEmpadrona, MarcaEmpadrona, NumeroSerieArma" listener="#{citasEmpadronamientoController.obtenerMarcaXTipoArma()}" />  
                            </p:selectOneMenu>
                        </div>
                    </div>    
                    
                    <div class="ui-g">
                        <div class="ui-g-12 ui-md-1 ui-lg-1">   
                            <p:outputLabel value="Número de Serie" for="NumeroSerieArma" />
                        </div>
                        <div class="ui-g-12 ui-md-4 ui-lg-4">       
                            <p:inputText id="NumeroSerieArma"  
                                         value="#{citasEmpadronamientoController.numeroSerieArma}"
                                         maxlength="25" >
                                <p:ajax event="blur" update="@this" listener="#{citasEmpadronamientoController.buscaPorSerieTarjeta()}"/>
                            </p:inputText>
                        </div>   
                        <div class="ui-g-12 ui-md-2 ui-lg-2">   
                            <p:outputLabel value="Voucher de Pago" for="NumeroVoucherPago"
                                           rendered="#{citasEmpadronamientoController.visualizaVoucher}" />
                        </div>
                        <div class="ui-g-12 ui-md-1 ui-lg-1">       
                            <p:inputText id="NumeroVoucherPago" value="#{citasEmpadronamientoController.filtroComp}" 
                                         rendered="#{citasEmpadronamientoController.visualizaVoucher}" >
                                <p:ajax event="blur" update="@this"/>
                                <p:keyFilter mask="num" preventPaste="true"/>
                            </p:inputText>
                        </div>   
                        <div class="ui-g-12 ui-md-1 ui-lg-1">       
                            <p:commandButton value="Buscar" process="@this,datosBuscaComprobante" update="panDatosArmas"
                                             rendered="#{citasEmpadronamientoController.visualizaVoucher}"
                                             actionListener="#{citasEmpadronamientoController.buscarDlgComprobante()}" />
                        </div>                           
                        <div class="ui-g-12 ui-md-3 ui-lg-3" style="display:none;"></div>
                    </div>   
                    
                    <div class="ui-g">
                        <div class="ui-g-12 ui-md-1 ui-lg-1">  
                            <p:outputLabel value="Marca" for="MarcaEmpadrona" />
                        </div>
                        <div class="ui-g-12 ui-md-6 ui-lg-4">                                 
                            <p:selectOneMenu id="MarcaEmpadrona" value="#{citasEmpadronamientoController.marcaArmaEmpadromiento}" filter="true">
                                <f:selectItem itemLabel="SELECCIONE" itemValue="#{null}"/>
                                <f:selectItems var="item" itemValue="#{item}" itemLabel="#{item.nombre}"
                                               value="#{citasEmpadronamientoController.lstMarcaTipoArmaEmpadrona}"/>
                                <p:ajax event="change" partialSubmit="true" process="@this" update="MarcaEmpadrona, NumeroSerieArma" listener="#{citasEmpadronamientoController.buscaPorSerieTarjeta()}" />  
                            </p:selectOneMenu>
                        </div>   
                        <div class="ui-g-12 ui-md-5 ui-lg-7">                         
                            <h:panelGrid id="datosBuscaComprobante" columns="6" rendered="#{citasEmpadronamientoController.reciboBn ne null}">
                                <p:outputLabel value="Nro de Comprobante: " rendered="#{citasEmpadronamientoController.reciboBn ne null}"/>
                                <p:outputLabel value="#{citasEmpadronamientoController.reciboBn.nroSecuencia}"  style="font-weight:bold; font-size: large"
                                               rendered="#{citasEmpadronamientoController.reciboBn ne null}"/>
                                <p:outputLabel value="Fecha Movimiento: " rendered="#{citasEmpadronamientoController.reciboBn ne null}"/>
                                <p:outputLabel value="#{citasEmpadronamientoController.reciboBn.fechaMovimiento}" style="font-weight:bold; font-size: large"
                                               rendered="#{citasEmpadronamientoController.reciboBn ne null}">
                                    <f:convertDateTime pattern="#{bundle.FormatoFecha}"/>
                                </p:outputLabel>
                                <p:outputLabel value="Importe: " rendered="#{citasEmpadronamientoController.reciboBn ne null}"/>
                                <p:outputLabel value="#{citasEmpadronamientoController.reciboBn.importe}"  style="font-weight:bold; font-size: large"
                                               rendered="#{citasEmpadronamientoController.reciboBn ne null}"/>
                            </h:panelGrid>    
                        </div>   
                        
                    </div>  
                    
                    <div class="ui-g">
                        <div class="ui-g-12 ui-md-1 ui-lg-1">                          
                            <p:outputLabel value="Modelo" for="Modelo" />
                        </div>
                        <div class="ui-g-12 ui-md-6 ui-lg-4">                                  
                            <p:inputText id="Modelo"  
                                         value="#{citasEmpadronamientoController.modeloArma}" 
                                         maxlength="100" >
                                <p:ajax event="blur" update="@this"/>
                            </p:inputText>
                        </div>   
                        <div class="ui-g-12 ui-md-5 ui-lg-7" style="display:none;"></div>
                    </div> 
                    
                    <div class="ui-g">
                        <div class="ui-g-12 ui-md-1 ui-lg-1"> 
                            <p:outputLabel value="Calibre" for="Calibre" />
                        </div>
                        <div class="ui-g-12 ui-md-4 ui-lg-4">    
                            <p:inputText id="Calibre"  
                                         value="#{citasEmpadronamientoController.calibreArma}" 
                                         maxlength="100" >
                                <p:ajax event="blur" update="@this"/>
                            </p:inputText>
                        </div>   
                        
                        <div class="ui-g-12 ui-md-2 ui-lg-2">  
                            <p:commandButton value="Agregar Arma" actionListener="#{citasEmpadronamientoController.agregarArmaEmpadronamiento}"
                             id="agregarArmaEmpadronamiento"
                             icon="ui-icon-plus"
                             styleClass="botonAgregar"
                             process="@this,panDatosArmas" update="panDatosArmas"></p:commandButton>
                        </div>  
                        <div class="ui-g-12 ui-md-4 ui-lg-4">  
                            <p:outputLabel value="Nota: Registrar un máximo de 5 armas" style="font-weight:bold;color: green"/>
                        </div>      
                        <div class="ui-g-12 ui-md-1 ui-lg-1" style="display:none;"></div>
                    </div>         
                    
                    <div class="ui-g">
                            <div class="ui-g-12 ui-md-12 ui-lg-12">   
                                <p:dataTable id="listaArmasEmpadronamiento" value="#{citasEmpadronamientoController.listDetalleArmaTemp}" 
                                             var="item"
                                             rowKey="#{item.idKey}"
                                             selection="#{citasEmpadronamientoController.listDetalleArmaTempSelect}"                                 
                                             emptyMessage="#{bundle.MensajeNoResultados}" 
                                             currentPageReportTemplate="#{bundle.TotalRegistrosEncontrados} {totalRecords} #{bundle.DescripcionItemsEncontrados}"
                                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"  
                                             rowsPerPageTemplate="#{bundle.PaginatorFilasPorPagina}">
                                    <p:column selectionMode="multiple" style="width:5%;text-align:center" />
                                    <p:column headerText="Serie" style="text-align: center;" > 
                                        <h:outputText value="#{item.nroSerie}" />
                                    </p:column>
                                    <p:column headerText="Tipo de Arma" style="text-align: center;" > 
                                        <h:outputText value="#{item.tipoArma}" />
                                    </p:column>
                                    <p:column headerText="Marca" style="text-align: center;" > 
                                        <h:outputText value="#{item.marca}" />
                                    </p:column>
                                    <p:column headerText="Modelo" style="text-align: center;" > 
                                        <h:outputText value="#{item.modelo}" />
                                    </p:column>
                                    <p:column headerText="Calibre" style="text-align: center;" > 
                                        <h:outputText value="#{item.calibre}" />
                                    </p:column>
                                    <p:column headerText="Tipo de Internamiento" style="text-align: center;" > 
                                        <h:outputText value="#{item.tipoInternamiento}" />
                                    </p:column>
                                    <p:column headerText="Voucher de Pago" style="text-align: center;" > 
                                        <h:outputText value="#{item.reciboArma.nroSecuencia}" />
                                    </p:column>
                                    <p:column headerText="Importe Pagado" style="text-align: center;" > 
                                        <h:outputText value="#{item.reciboArma.importe}" />
                                    </p:column>
                                </p:dataTable>
                            </div> 
                        </div> 
                        <div class="ui-g">
                            <div class="ui-g-12 ui-md-2 ui-lg-2"> 
                                <p:commandButton value="#{bundleGamac.EliminarSeleccionados_cmmb}" actionListener="#{citasEmpadronamientoController.removerArmasTemporal}"
                                                 id="eliminarArma"
                                                 disabled="#{citasEmpadronamientoController.listDetalleArmaTemp eq null}"
                                                 icon="ui-icon-closethick"
                                                 process="@this, listaArmasEmpadronamiento" update="@this, eliminarArma, listaArmasEmpadronamiento"/>
                            </div>
                            <div class="ui-g-12 ui-md-10 ui-lg-10" style="display:none;"></div>
                        </div> 
                </p:panel> <br/>  

                <p:panel header="Datos de las Municiones" id="panDatosMuniciones" style=" border-color: #2399E5"> 
                    <div class="ui-g">
                        <div class="ui-g-12 ui-md-3 ui-lg-3">
                            <p:outputLabel value="Marca"/>
                            <p:inputText id="idmarcaMunicion"  
                                         value="#{citasEmpadronamientoController.marcaMunicion}" 
                                         disabled="#{citasEmpadronamientoController.sinMarcaMunicion}"
                                         maxlength="100" >
                                <p:ajax event="blur" update="@this"/>
                            </p:inputText>                                 
                        </div>
                        <div class="ui-g-12 ui-md-1 ui-lg-1">
                            <br/>     
                            <p:selectBooleanCheckbox itemLabel="Sin Marca" value="#{citasEmpadronamientoController.sinMarcaMunicion}">
                                <p:ajax update="panDatosMuniciones" listener="#{citasEmpadronamientoController.visualizarSinMarca()}" />
                            </p:selectBooleanCheckbox>
                        </div>
                        <div class="ui-g-12 ui-md-3 ui-lg-3">
                            <p:outputLabel value="Calibre"/>
                            <p:inputText id="idCalibreMunicion"  
                                         value="#{citasEmpadronamientoController.calibreMunicion}" 
                                         maxlength="100" >
                                <p:ajax event="blur" update="@this"/>
                            </p:inputText>                                 
                        </div>
                        <div class="ui-g-12 ui-md-2 ui-lg-2">
                            <p:outputLabel value="Cant. Munición"/>
                            <p:inputText id="idCantMunicion"  
                                         value="#{citasEmpadronamientoController.cantidadMunicion}" 
                                         size="5" maxlength="5" >
                                <p:ajax event="blur" update="@this"/>
                                <p:keyFilter mask="pint"/>
                            </p:inputText>                                 
                        </div>
                        <div class="ui-g-12 ui-md-2 ui-lg-2">
                            <br/>
                            <p:commandButton value="Agregar Munición" actionListener="#{citasEmpadronamientoController.agregarMunicionEmpadronamiento}"
                             id="agregarMunicionEmpadronamiento"
                             icon="ui-icon-plus"
                             styleClass="botonAgregar"
                             process="@this,panDatosMuniciones" update="panDatosMuniciones"></p:commandButton>
                        </div>  
                    </div>
                    
                    <div class="ui-g">
                            <div class="ui-g-12 ui-md-12 ui-lg-12">   
                                <p:dataTable id="listaMunicionesEmpadronamiento" value="#{citasEmpadronamientoController.listDetalleMunicionTemp}" 
                                             var="item"
                                             rowKey="#{item.id}"
                                             selection="#{citasEmpadronamientoController.listDetalleMunicionTempSelect}"                                 
                                             emptyMessage="#{bundle.MensajeNoResultados}" 
                                             currentPageReportTemplate="#{bundle.TotalRegistrosEncontrados} {totalRecords} #{bundle.DescripcionItemsEncontrados}"
                                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"  
                                             rowsPerPageTemplate="#{bundle.PaginatorFilasPorPagina}">
                                    <p:column selectionMode="multiple" style="width:5%;text-align:center" />
                                    <p:column headerText="Marca" style="text-align: center;" > 
                                        <h:outputText value="#{item.marca}" />
                                    </p:column>
                                    <p:column headerText="Calibre" style="text-align: center;" > 
                                        <h:outputText value="#{item.calibre}" />
                                    </p:column>
                                    <p:column headerText="Cantidad Munición (Unids)" style="text-align: center;" > 
                                        <h:outputText value="#{item.cantidad}" />
                                    </p:column>
                                </p:dataTable>
                            </div> 
                        </div> 
                        <div class="ui-g">
                            <div class="ui-g-12 ui-md-2 ui-lg-2"> 
                                <p:commandButton value="#{bundleGamac.EliminarSeleccionados_cmmb}" actionListener="#{citasEmpadronamientoController.removerMunicionesTemporal()}"
                                                 id="eliminarMunicion"
                                                 disabled="#{citasEmpadronamientoController.listDetalleMunicionTemp eq null}"
                                                 icon="ui-icon-closethick"
                                                 process="@this, listaMunicionesEmpadronamiento" update="@this, eliminarMunicion, listaMunicionesEmpadronamiento"/>
                            </div>
                            <div class="ui-g-12 ui-md-10 ui-lg-10" style="display:none;"></div>
                        </div> 
                </p:panel>    
                <br/>
                
                <p:panel id="pnlBtns" style="border: 0px!important; margin-bottom: 3px" >
                    <div class="ui-g">
                        <div class="ui-g-12 ui-md-1 ui-lg-3"></div>

                        <div class="ui-g-12 ui-md-5 ui-lg-3">
                            <p:commandButton id="btnConfAdd" icon="ui-icon-check" partialSubmit="true"
                                             process="@this, addArmaFormEmpadrona"
                                             action="#{citasEmpadronamientoController.addArma()}" value="Guardar" 
                                             />
                        </div>
                        <div class="ui-g-12 ui-md-3 ui-lg-3" style="text-align: right">
                            <p:commandButton immediate="true" icon="ui-icon-close" value="Cerrar" update="@this" onclick="PF('wvDlgAddArmaEmpadrona').hide();" />
                        </div>
                        <div class="ui-g-12 ui-md-1 ui-lg-3"></div>
                    </div>
                </p:panel>                

            </div>
        </h:form>
    </p:dialog>

    <script type="text/javascript">

        function showDlgAddArmaEmpadrona() {
            $("div[id*='dlgAddArmaEmpadrona']").css('top', 10);
            //$("div[id*='buscarArmaId_content']").attr("style", "padding:2px!important");

            $("div[id*='dlgAddArmaEmpadrona'] > .ui-dialog-titlebar ").attr("style", "margin:0!important; padding: 5px!important; color:#fff!important; background:#2399e5!important;");
            $("div[id*='dlgAddArmaEmpadrona'] > .ui-dialog-titlebar > .ui-dialog-title").attr("style", "margin:0!important; font-size:110%!important; color:#fff!important;");
            $("div[id*='dlgAddArmaEmpadrona'] > .ui-dialog-content").attr("style", "padding:4px!important;");

            //$("div[id*='pnlDatArmaEmpadrona_content'], div[id*='pnlDatArmGam_content'], div[id*='pnlgComprobante_content'], div[id*='pnlBtns_content']").attr("style", "padding:0!important");
            //$("div[id*='pnlDatArmaEmpadrona_content'], div[id*='pnlDatArmGam_content'], div[id*='pnlgComprobante_content'], div[id*='pnlBtns_content']").children(".ui-g").children().attr("style", "padding:3px!important;");
            
            $("div[id*='pnlDatArmaEmpadrona_content'], div[id*='pnlDatArmGam_content'],  div[id*='pnlBtns_content']").attr("style", "padding:0!important");
            $("div[id*='pnlDatArmaEmpadrona_content'], div[id*='pnlDatArmGam_content'],  div[id*='pnlBtns_content']").children(".ui-g").children().attr("style", "padding:3px!important;");
        
            $(".txtLabel").attr("style", "line-height: 190%");
            $(".ui-datatable-footer").attr("style", "padding:2px!important");
            $(".ui-state-disabled, .ui-widget-content .ui-state-disabled, .ui-widget-header .ui-state-disabled").attr("style", "opacity: .70; filter: Alpha(Opacity=70); background-image: none;");
        }

        function buscaRecAddArm() {
            //$("div[id*='pnlDatArmaEmpadrona_content'], div[id*='pnlDatArmGam_content'], div[id*='pnlgComprobante_content'], div[id*='pnlBtns_content']").attr("style", "padding:0!important");
            //$("div[id*='pnlDatArmaEmpadrona_content'], div[id*='pnlDatArmGam_content'], div[id*='pnlgComprobante_content'], div[id*='pnlBtns_content']").children(".ui-g").children().attr("style", "padding:3px!important;");

            $("div[id*='pnlDatArmaEmpadrona_content'], div[id*='pnlDatArmGam_content'],  div[id*='pnlBtns_content']").attr("style", "padding:0!important");
            $("div[id*='pnlDatArmaEmpadrona_content'], div[id*='pnlDatArmGam_content'],  div[id*='pnlBtns_content']").children(".ui-g").children().attr("style", "padding:3px!important;");
            
            $(".txtLabel").attr("style", "line-height: 190%");
            $(".ui-datatable-footer").attr("style", "padding:2px!important");
            $(".ui-state-disabled, .ui-widget-content .ui-state-disabled, .ui-widget-header .ui-state-disabled").attr("style", "opacity: .70; filter: Alpha(Opacity=70); background-image: none;");
        }

    </script>

</ui:composition>

