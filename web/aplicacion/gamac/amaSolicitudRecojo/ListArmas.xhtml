<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <ui:composition template="/template.xhtml">
        <ui:define name="title">
            <h:outputText value="#{bundleGamac.ListadoArmas_Titulo}" rendered="#{amaSolicitudRecojoController.estado == 'BUSCAR'}"/>
        </ui:define>
        <ui:define name="body">
            <h:form id="listarForm" rendered="#{amaSolicitudRecojoController.estado == 'BUSCAR'}">
                <div class="ui-fluid">
                    <div class="ui-g">
                        <div class="ui-g-12 ui-md-12 ui-lg-8" >
                            <p:fieldset legend="#{bundleGamac.Busqueda}" id="fsBusqueda">
                                <div class="ui-g">
                                    <div class="ui-g-12 ui-md-6 ui-lg-2" >
                                        <p:outputLabel value="Tipo de Solicitud"/>
                                    </div>
                                    <div class="ui-g-12 ui-md-6 ui-lg-4" >
                                        <p:selectOneMenu id="cbTipoSolicitud" value="#{amaSolicitudRecojoController.tipoSolicitud}" autoWidth="false">
                                            <f:selectItem itemLabel="---" itemValue="#{null}"/>
                                            <f:selectItems var="item" itemValue="#{item}" itemLabel="#{item.nombre}" 
                                                           value="#{amaSolicitudRecojoController.listTipoSolicitud}"/>
                                            <p:ajax event="change" update="@form" process="@this," listener="#{amaSolicitudRecojoController.reiniciarVlores}"/>
                                        </p:selectOneMenu>
                                    </div>
                                    <div class="ui-g-12 ui-md-6 ui-lg-2" >
                                        <p:outputLabel value="Sede"/>
                                    </div>
                                    <div class="ui-g-12 ui-md-6 ui-lg-4" >
                                        <p:selectOneMenu id="cbDirSucamec" value="#{amaSolicitudRecojoController.sedeSelect}"
                                                         autoWidth="false"
                                                         disabled="#{amaSolicitudRecojoController.tipoSolicitud.codProg eq 'TP_SOLIC_REIARM'}">
                                            <f:selectItem itemLabel="---" itemValue="#{null}"/>
                                            <f:selectItems var="item" itemValue="#{item}" itemLabel="#{item.referencia}" 
                                                           value="#{amaSolicitudRecojoController.listaDireccionSucamec()}"/>
                                            <p:ajax event="change" update="@form" process="@this," listener="#{amaSolicitudRecojoController.reiniciarListaFinal}"/>
                                        </p:selectOneMenu>
                                    </div>
                                </div>
                                <div class="ui-g" style="display: #{amaSolicitudRecojoController.tipoSolicitud.codProg ne null?'block':'none'}">
                                    <div class="ui-g-12 ui-md-12 ui-lg-2" >
                                        <p:outputLabel value="Fecha de emisiÃ³n"/>
                                    </div>
                                    <div class="ui-g-12 ui-md-5 ui-lg-2" >
                                        <p:calendar id="fechainicio" maxdate="#{amaSolicitudRecojoController.fechaHoy}"
                                                    showOn="button" value="#{amaSolicitudRecojoController.fechaini}"
                                                    pattern="#{bundleGamac.FormatoFecha}"
                                                    navigator="true" locale="es">  
                                            <p:ajax event="dateSelect" update="fechafin" />
                                            <f:convertDateTime pattern="#{bundleGamac.FormatoFecha}" />
                                        </p:calendar>
                                    </div>
                                    <div class="ui-g-12 ui-md-2 ui-lg-1" >
                                        <p:outputLabel value=" al " />
                                    </div>
                                    <div class="ui-g-12 ui-md-5 ui-lg-2" >
                                        <p:calendar id="fechafin" mindate="#{amaSolicitudRecojoController.fechaini}" maxdate="#{amaSolicitudRecojoController.fechaHoy}"
                                                    showOn="button" value="#{amaSolicitudRecojoController.fechafin}"
                                                    pattern="#{bundleGamac.FormatoFecha}"
                                                    navigator="true" locale="es">
                                            <f:convertDateTime pattern="#{bundleGamac.FormatoFecha}" />
                                        </p:calendar>
                                    </div>
                                </div>
                                <div class="ui-g" style="display: #{amaSolicitudRecojoController.tipoSolicitud.codProg ne null?'block':'none'}">
                                    <div class="ui-g-12 ui-md-6 ui-lg-2" >
                                        <p:outputLabel value="Buscar por:"/>
                                    </div>
                                    <div class="ui-g-12 ui-md-6 ui-lg-4" >
                                        <p:selectOneMenu  value="#{amaSolicitudRecojoController.idTipoBusqueda}" id="cbCriterio1" 
                                                          rendered="#{amaSolicitudRecojoController.tipoSolicitud.codProg eq 'TP_SOLIC_RECARM'}"
                                                          autoWidth="false">
                                            <f:selectItem itemValue="#{null}" itemLabel="---" />
                                            <f:selectItem itemValue="1" itemLabel="RAZON SOCIAL O NOMBRE"/>
                                            <f:selectItem itemValue="2" itemLabel="RUC"/>
                                            <f:selectItem itemValue="3" itemLabel="DNI"/>
                                            <f:selectItem itemValue="4" itemLabel="SERIE ARMA" />
                                            <p:ajax event="change" update="cbCriterio1 "/>
                                        </p:selectOneMenu>
                                        <p:selectOneMenu value="#{amaSolicitudRecojoController.idTipoBusqueda}" id="cbCriterio2" 
                                                         rendered="#{amaSolicitudRecojoController.tipoSolicitud.codProg eq 'TP_SOLIC_REIARM'}"
                                                         autoWidth="false">
                                            <f:selectItem itemValue="#{null}" itemLabel="---" />
                                            <f:selectItem itemValue="4" itemLabel="SERIE ARMA" />
                                            <f:selectItem itemValue="5" itemLabel="NRO. GUIA"/>
                                            <p:ajax event="change" update="cbCriterio1 "/>
                                        </p:selectOneMenu>
                                    </div>
                                    <div class="ui-g-12 ui-md-6 ui-lg-4" >
                                        <p:inputText value="#{amaSolicitudRecojoController.filtro}" id="filtro"/>
                                    </div>
                                    <div class="ui-g-12 ui-md-6 ui-lg-2" >
                                        <p:commandButton value="Buscar" icon="ui-icon-search" 
                                                         disabled="#{amaSolicitudRecojoController.tipoSolicitud eq null}"
                                                         actionListener="#{amaSolicitudRecojoController.buscar('')}" process="@this,fsBusqueda" update="@this,listasArmas"/>
                                    </div>
                                </div>
                            </p:fieldset>
                        </div>
                        <div class="ui-g-12 ui-md-12 ui-lg-4" align="center">
                            <p:fieldset legend="Opciones" id="fsOpciones">
                                <div class="ui-g">
                                    <div class="ui-g-0 ui-md-0 ui-lg-1" />
                                    <div class="ui-g-12 ui-md-6 ui-lg-4" >
                                        <p:commandButton value="#{bundleGamac.BtnSolicitarRecojo} 
                                                         (#{amaSolicitudRecojoController.lstArmasRecojoFinal ne null and amaSolicitudRecojoController.lstArmasRecojoFinal.size()>0?amaSolicitudRecojoController.lstArmasRecojoFinal.size():'0'})"
                                                         style="background-color: #8BC34A;color: #FDFEFE;border-color: #8BC34A;"
                                                         disabled="#{amaSolicitudRecojoController.tipoSolicitud eq null or amaSolicitudRecojoController.tipoSolicitud.codProg ne 'TP_SOLIC_RECARM'}"
                                                         actionListener="#{amaSolicitudRecojoController.openDlgConfRecojo(false)}"
                                                         process="@this,dtArmas1" 
                                                         update="@this, fsOpciones"/>
                                        <p:outputLabel value="Para el traslado de las armas seleccionadas se requiere custodio" rendered="false" style="float: right !important; height: 20%;width: 40%"/> 
                                    </div>
                                    <div class="ui-g-0 ui-md-0 ui-lg-1" />
                                    <div class="ui-g-12 ui-md-6 ui-lg-4" >
                                        <p:commandButton value="#{bundleGamac.BtnSolicitarReingreso}  
                                                         (#{amaSolicitudRecojoController.lstArmasReingresoFinal ne null and amaSolicitudRecojoController.lstArmasReingresoFinal.size()>0?amaSolicitudRecojoController.lstArmasReingresoFinal.size():'0'})"
                                                         style="background-color: #EB984E;color: #FDFEFE;border-color: #EB984E;"
                                                         disabled="#{amaSolicitudRecojoController.tipoSolicitud eq null or amaSolicitudRecojoController.tipoSolicitud.codProg ne 'TP_SOLIC_REIARM'}"
                                                         actionListener="#{amaSolicitudRecojoController.openDlgConfReingreso(false)}"
                                                         process="@this,dtArmas2" 
                                                         update="@this, fsOpciones"/>
                                        <p:outputLabel value="Para el traslado de las armas seleccionadas se requiere custodio" rendered="false" style="float: right !important; height: 20%;width: 40%"/> 
                                    </div>
                                    <div class="ui-g-0 ui-md-0 ui-lg-1" />
                                </div>
                            </p:fieldset>
                        </div>
                    </div>
                    <div class="ui-g" style="display:#{amaSolicitudRecojoController.tipoSolicitud eq null?'block':'none'}">
                        <div class="ui-g-12 ui-md-12 ui-lg-12" >
                            <h:outputLabel value="#{bundleGamac.InstruccionesSolRecojo}:" style="font-weight: bold"/>
                        </div>
                        <div class="ui-g-12 ui-md-12 ui-lg-12" >
                            <h:outputLabel value="#{bundleGamac.DestalleInstruccionesSolRecojo}" escape="false"/>
                        </div>
                    </div>
                    <h:panelGroup id="listasArmas" layout="block" class="ui-widget">
                        <div class="ui-g" style="display:#{amaSolicitudRecojoController.tipoSolicitud.codProg eq 'TP_SOLIC_RECARM'?'block':'none'}">
                            <div class="ui-g-12 ui-md-12 ui-lg-12" >
                                <p:dataTable id="dtArmas1" value="#{amaSolicitudRecojoController.lstArmasNuevas}" 
                                             rendered="#{amaSolicitudRecojoController.tipoSolicitud.codProg eq 'TP_SOLIC_RECARM'}"
                                             reflow="true"
                                             var="item"
                                             rowKey="#{item.ID}"
                                             selection="#{amaSolicitudRecojoController.lstArmasNuevasSelect}"                                 
                                             emptyMessage="#{bundleGamac.MensajeNoResultados}" 
                                             paginator="true" rows="#{bundleGamac.PaginatorFilas}"  
                                             currentPageReportTemplate="#{bundleGamac.TotalRegistrosEncontrados} {totalRecords} #{bundleGamac.DescripcionItemsEncontrados}"
                                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} {Exporters}"  
                                             rowsPerPageTemplate="#{bundleGamac.PaginatorFilasPorPagina}"
                                             rowStyleClass="#{amaSolicitudRecojoController.isArmaRecojoSelect(item)?'datatable-row-amarillo':''}">
                                    <f:facet name="{Exporters}">
                                        <h:commandLink>
                                            <p:graphicImage name="/icons/xls.png" width="30"/>
                                            <p:dataExporter type="xls" target="dtArmas1" fileName="ListadoArmas"/>
                                        </h:commandLink>
                                    </f:facet>
                                    <p:column headerText="Accion" style="width: 3%;text-align: center;" exportable="false">
                                        <p:commandButton icon="#{amaSolicitudRecojoController.isArmaRecojoSelect(item)?'ui-icon-close':'ui-icon-check'}"
                                                         style="#{amaSolicitudRecojoController.isArmaRecojoSelect(item)? 'background-color: #E53935;color: #E53935;border-color: #E53935;':''}"
                                                         process="@this"
                                                         update="@this, dtArmas1"
                                                         actionListener="#{amaSolicitudRecojoController.anadirArmaRecojo(item)}"/>
                                    </p:column>
                                    <p:column headerText="AlmacÃ©n" style="text-align: center;">
                                        <h:outputText value="#{amaSolicitudRecojoController.obtenerDescDireccion(item.IDALMACEN, 'sede')}"/>
                                    </p:column>
                                    <p:column headerText="Nro Tarjeta Propiedad" style="text-align: center;">
                                        <h:outputText value="#{item.NRO_RUA}"/>
                                    </p:column>
                                    <p:column headerText="Estado Tarjeta Prop." style="text-align: center;" filterBy="#{item.ESTADO_TP}">
                                        <h:outputText value="#{item.ESTADO_TP}"/>
                                    </p:column>
                                    <p:column headerText="Propietario" style="text-align: center;" >
                                        <h:outputText value="#{item.RZN_SOCIAL==null?item.NOMBRES.concat(' ').concat(item.APE_PAT).concat(' ').concat(item.APE_MAT):item.RZN_SOCIAL}"/>
                                    </p:column> 
                                    <p:column headerText="Documento" style="text-align: center;" filterBy="#{item.NUM_DOC==null?item.RUC:item.NUM_DOC}">
                                        <h:outputText value="#{item.TIPODOC==null?'RUC':item.TIPODOC} - #{item.NUM_DOC==null?item.RUC:item.NUM_DOC}" />
                                    </p:column>
                                    <p:column headerText="Fecha EmisiÃ³n" style="text-align: center;" >
                                        <h:outputText value="#{item.FECHA_EMISION}">
                                            <f:convertDateTime pattern="#{bundleGamac.FormatoFecha}" />
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Tipo de Arma" style="text-align: center;" > 
                                        <h:outputText value="#{item.TIPARMA}" />
                                    </p:column>
                                    <p:column headerText="Serie" style="text-align: center;" > 
                                        <h:outputText value="#{item.SERIE}" />
                                    </p:column>
                                    <p:column headerText="Calibre" style="text-align: center;" > 
                                        <h:outputText value="#{amaSolicitudRecojoController.obtenerCalibresMap(item)}" />
                                    </p:column>
                                    <p:column headerText="Marca" style="text-align: center;" filterBy="#{item.MARCA}"> 
                                        <h:outputText value="#{item.MARCA}" />
                                    </p:column>
                                    <p:column headerText="Modelo" style="text-align: center;" filterBy="#{item.MODELO}"> 
                                        <h:outputText value="#{item.MODELO}" />
                                    </p:column>
                                </p:dataTable>
                            </div>
                        </div>
                        <div class="ui-g" style="display:#{amaSolicitudRecojoController.tipoSolicitud.codProg eq 'TP_SOLIC_REIARM'?'block':'none'}">
                            <div class="ui-g-12 ui-md-12 ui-lg-12" >
                                <p:dataTable id="dtArmas2" value="#{amaSolicitudRecojoController.lstArmasNuevas}" 
                                             rendered="#{amaSolicitudRecojoController.tipoSolicitud.codProg eq 'TP_SOLIC_REIARM'}"
                                             reflow="true"
                                             var="item"
                                             rowKey="#{item.id}"
                                             selection="#{amaSolicitudRecojoController.lstArmasNuevasSelect}"                                 
                                             emptyMessage="#{bundleGamac.MensajeNoResultados}" 
                                             paginator="true" rows="#{bundleGamac.PaginatorFilas}"  
                                             currentPageReportTemplate="#{bundleGamac.TotalRegistrosEncontrados} {totalRecords} #{bundleGamac.DescripcionItemsEncontrados}"
                                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} {Exporters}"  
                                             rowsPerPageTemplate="#{bundleGamac.PaginatorFilasPorPagina}"
                                             rowStyleClass="#{amaSolicitudRecojoController.isArmaReingresoSelect(item)?'datatable-row-amarillo':''}">
                                    <f:facet name="{Exporters}">
                                        <h:commandLink>
                                            <p:graphicImage name="/icons/xls.png" width="30"/>
                                            <p:dataExporter type="xls" target="dtArmas2" fileName="ListadoArmas"/>
                                        </h:commandLink>
                                    </f:facet>
                                    <p:column headerText="Accion" style="width: 3%;text-align: center;" exportable="false">
                                        <p:commandButton icon="#{amaSolicitudRecojoController.isArmaReingresoSelect(item)?'ui-icon-close':'ui-icon-check'}"
                                                         style="#{amaSolicitudRecojoController.isArmaReingresoSelect(item)? 'background-color: #E53935;color: #E53935;border-color: #E53935;':''}"
                                                         process="@this"
                                                         update="@this, dtArmas2"
                                                         actionListener="#{amaSolicitudRecojoController.anadirArmaReingreso(item)}"/>
                                    </p:column>
                                    <p:column headerText="NÃºmero de GuÃ­a" style="text-align: center;">
                                        <h:outputText value="#{item.nroGuia}"/>
                                    </p:column>
                                    <p:column headerText="Fecha EmisiÃ³n (GuÃ­a)" style="text-align: center;" >
                                        <h:outputText value="#{item.fechaEmision}">
                                            <f:convertDateTime pattern="#{bundleGamac.FormatoFecha}" />
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Fecha Vencimiento (GuÃ­a)" style="text-align: center;" >
                                        <h:outputText value="#{item.fechaVencimiento}">
                                            <f:convertDateTime pattern="#{bundleGamac.FormatoFecha}" />
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Tipo de Arma" style="text-align: center;" > 
                                        <h:outputText value="#{item.modeloId.tipoArmaId.nombre}" />
                                    </p:column>
                                    <p:column headerText="CÃ³digo" style="text-align: center;">
                                        <h:outputText value="#{item.nroRua eq null?item.codigo:item.nroRua}"/>
                                    </p:column>
                                    <p:column headerText="Serie" style="text-align: center;" > 
                                        <h:outputText value="#{item.serie}" />
                                    </p:column>
                                    <p:column headerText="Calibre" style="text-align: center;" > 
                                        <h:outputText value="#{amaSolicitudRecojoController.obtenerCalibres(item.modeloId)}" />
                                    </p:column>
                                    <p:column headerText="Marca" style="text-align: center;" > 
                                        <h:outputText value="#{item.modeloId.marcaId.nombre}" />
                                    </p:column>
                                    <p:column headerText="Modelo" style="text-align: center;" > 
                                        <h:outputText value="#{item.modeloId.modelo}" />
                                    </p:column>
                                </p:dataTable>
                            </div>
                        </div>
                    </h:panelGroup>
                </div>
            </h:form>
            <ui:include src="dlgNotificacion.xhtml" />
            <ui:include src="dlgSolRecojo.xhtml" />
            <ui:include src="dlgSolReingreso.xhtml" />
            <ui:include src="dlgCrearDireccionPers.xhtml" />
            <ui:include src="mensajeAviso.xhtml" />
        </ui:define>
    </ui:composition>
</html>
