<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui">
    <ui:define name="title">
        <h:outputText value="#{bundleDisca.BuscarDcGamacArmasTitulo}" rendered="#{dcGamacLicenciasController.estado == 'BUSCAR'}"/>
        <h:outputText value="#{bundleDisca.VerDcGamacArmasTitulo}" rendered="#{dcGamacLicenciasController.estado == 'VER'}"/>
    </ui:define>
    <ui:define name="body">
        
        <div class="ui-fluid">
            <div class="ui-g">
                <div class="ui-g-12">
                    <h:form id="buscarForm" rendered="#{dcGamacLicenciasController.estado == 'BUSCAR'}">
                        <p:focus context="buscarForm" />
                        <p:defaultCommand target="botonBuscar"/>
                        
                        <p:panel id="buscarPanel" style="margin-bottom:10px;" toggleable="true" toggleSpeed="500" widgetVar="panel" >
                            <div class="ui-g">
                                <div class="ui-g-12 ui-md-4 ui-lg-2">
                                    <p:outputLabel id="buscarFiltro" value="#{bundleDisca.Filtro}" />
                                    <p:selectOneMenu id="tipoId" value="#{dcGamacLicenciasController.tipo}" autoWidth="false" onchange="selectTipoFiltro()" >
                                        <f:selectItem itemValue="#{null}" itemLabel="--TODOS--"/>
                                        <f:selectItem itemValue="licencia" itemLabel="NRO LICENCIA DE POSESIÓN"/>
                                        <f:selectItem itemValue="serie" itemLabel="NRO SERIE"/>
                                        <ui:remove>
                                        <f:selectItem itemValue="portador" itemLabel="DOC PORTADOR"/>
                                        </ui:remove>
                                    </p:selectOneMenu>
                                </div>
                                <div class="ui-g-12 ui-md-3 ui-lg-2">
                                    <p:spacer />
                                    <p:inputText  value="#{dcGamacLicenciasController.filtro}" size="40" placeholder="#{bundleDisca.PhCriterio}"/>
                                </div>
                                <div class="ui-g-12 ui-md-3 ui-lg-1">
                                    <p:spacer />
                                    <p:commandButton id="botonBuscar" value="#{bundleDisca.Buscar}" icon="ui-icon-search" oncomplete="completeFind();"
                                                     actionListener="#{dcGamacLicenciasController.buscar}"  update=":buscarForm" />
                                </div>
                            </div>
                            <p:blockUI block="buscarPanel" trigger="botonBuscar" />                            
                        </p:panel>
                        
                        <h:panelGroup id="buscarPanelTbl">
                            <h:panelGroup rendered="#{dcGamacLicenciasController.resultados == null}">
                                <br/><br/>
                                <h:outputLabel value="#{bundleDisca.Instrucciones}" style="font-weight: bold"/><br/><br/>
                                <h:outputLabel value="#{bundleDisca.InstruccionesGamacLicencias}" escape="false"/>
                            </h:panelGroup>
                            <h:panelGroup rendered="#{dcGamacLicenciasController.resultados != null}">
                                <h:panelGrid columns="2" style="border: 0px; width: 100%;">
                                    <h:outputLabel value="#{bundleDisca.Resultados}" escape="false" />
                                    <h:commandLink style="float: right; clear: both;">
                                        <p:graphicImage name="/icons/xls.png" width="32" alt="#{bundleDisca.ExportarExcel}"/>
                                        <p:dataExporter type="xls" target="buscarDatatable" fileName="BusquedaArmas" />
                                    </h:commandLink>
                                </h:panelGrid>
                                <p:dataTable id="buscarDatatable" value="#{dcGamacLicenciasController.resultados}"
                                             var="item"
                                             rowKey="#{item.id}"
                                             emptyMessage="#{bundleDisca.MensajeNoResultados}" 
                                             paginator="true" rows="#{bundleDisca.PaginatorFilas}" 
                                             currentPageReportTemplate="#{bundleDisca.TotalEncontrados} {totalRecords} #{bundleDisca.ItemsEncontrados}"
                                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"  
                                             rowsPerPageTemplate="#{bundleDisca.PaginatorFilasPorPagina}"
                                             reflow="true">
                                    <p:column headerText="NRO LIC. DE POSESIÓN" sortBy="#{item.NRO_LIC}" style="font-size:95%!important" class="ui-lg-1">
                                        <h:outputText value="#{item.NRO_LIC}" rendered="#{item.SISTEMA=='DISCA'}"/>
                                    </p:column>
                                    <p:column headerText="DATOS DEL ARMA" sortBy="#{item.TIPO_ARMA} #{item.MARCA} #{item.MODELO} #{item.CALIBRE}" style="font-size:95%!important" class="ui-lg-3">
                                        <h:outputText value="#{item.TIPO_ARMA} #{item.MARCA} #{item.MODELO} #{item.CALIBRE}"/>
                                    </p:column>
                                    <p:column headerText="SERIE" sortBy="#{item.NRO_SERIE}" style="font-size:95%!important" class="ui-lg-1">
                                        <h:outputText value="#{item.NRO_SERIE}"/>
                                    </p:column>
                                    <p:column headerText="FEC. EMISIÓN" sortBy="#{item.FEC_EMISION}" style="font-size:95%!important" class="ui-lg-1">
                                        <h:outputText value="#{item.FEC_EMISION}">
                                            <f:converter converterId="fechaConverter" />
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="FEC. VENC." sortBy="#{item.FEC_VENCIMIENTO}" style="font-size:95%!important" class="ui-lg-1">
                                        <h:outputText value="#{item.FEC_VENCIMIENTO}">
                                            <f:converter converterId="fechaConverter" />
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="PORTADOR" sortBy="#{item.PORTADOR}" style="font-size:95%!important" class="ui-lg-2">
                                        <h:outputText value="#{item.PORTADOR} - #{item.DOC_PORTADOR}"/>
                                    </p:column>
                                    <p:column headerText="SITUACIÓN" sortBy="#{item.SITUACION}" style="font-size:95%!important" class="ui-lg-1">
                                        <h:outputText value="#{item.SITUACION}"/>
                                    </p:column>
                                    <p:column headerText="ESTADO" sortBy="#{item.ESTADO}" style="font-size:95%!important" class="ui-lg-1">
                                        <h:outputText value="#{item.ESTADO}"/>
                                    </p:column>
                                    <ui:remove>
                                    <p:column headerText="#{bundleDisca.Ver}" exportable="false" width="4%">
                                        <p:commandLink actionListener="#{dcGamacLicenciasController.mostrarVerDlg(item)}" value="#{bundleDisca.Ver}" process="@this" partialSubmit="true" update="@none" ajax="true"/>
                                        <h:outputText value=" "/>
                                    </p:column>                                        
                                    </ui:remove>
                                    <p:column headerText="OPCIÓN" exportable="false" style="font-size:95%!important; text-align: right;" class="ui-lg-1">
                                        <div class="ui-row-editor ui-helper-clearfix ui-toolbar-group-right" style="padding: 0!important">
                                            <ui:remove>
                                            <p:commandLink  id="botonDocumento" 
                                                             ajax="false" 
                                                             partialSubmit="true"                              
                                                             immediate="true" target="_blank" >
                                                <p:fileDownload value="#{dcGamacLicenciasController.reporte(item)}" contentDisposition="inline" />
                                                <h:outputText styleClass="ui-icon ui-icon-print" style="margin:0 auto;" />
                                            </p:commandLink>                                                
                                            </ui:remove>
                                            <p:commandLink id="ajax" actionListener="#{dcGamacLicenciasController.mostrarVerDlg(item)}" style="font-size:95%!important" >
                                                <h:outputText styleClass="ui-icon ui-icon-search" style="margin:0 auto;" />                                            
                                            </p:commandLink>
                                        </div>
                                    </p:column>                                 
                                    
                                </p:dataTable>
                            </h:panelGroup>
                        </h:panelGroup>
                    </h:form>
                </div>
            </div>
        </div>
        
        <ui:include src="View.xhtml" />
        <ui:include src="DlgViewDisca.xhtml" />
        <ui:include src="DlgViewGamac.xhtml" />
        
        <script type="text/javascript">
            function selectTipoFiltro() {
                switch ($("select[id*='tipoId']").val()) {
                    case "licencia":
                        $("input[id*='filtroTexto']").attr("placeholder", "INGRESE NRO DE LICENCIA");
                        break;
                    case "serie":
                        $("input[id*='filtroTexto']").attr("placeholder", "INGRESE NRO DE SERIE");
                        break;
                    case "doc_prop":
                        $("input[id*='filtroTexto']").attr("placeholder", "INGRESE DOC PROPIETARIO");
                        break;
                    case "nom_prop":
                        $("input[id*='filtroTexto']").attr("placeholder", "INGRESE APELLIDOS Y NOMBRES DEL PROPIETARIO");
                        break;
                    case "doc_portador":
                        $("input[id*='filtroTexto']").attr("placeholder", "INGRESE DOC PORTADOR");
                        break;
                    case "nom_portador":
                        $("input[id*='filtroTexto']").attr("placeholder", "INGRESE APELLIDOS Y NOMBRES DEL PORTADOR");
                        break;
                }                
            }
            
            function completeFind(){
                $("div[id*='buscarPanel_content']").attr("style", "padding:0!important");
            }

            $(document).ready(function() { 
                //$(".ui-dialog-titlebar").attr("style", "padding:8px!important; margin:0!important");
                $(".txtLabel").parent().attr("style", "padding-top:11px");
                $(".ui-layout-unit-header").attr("style", "border: 1px solid #1f89ce; color: #fff; background: #2399e5;");
                $(".ui-state-disabled").attr("style", "opacity: .80; filter: Alpha(Opacity=80); background-image: none;");
                $("textarea:disabled").attr("style", "opacity: .80; filter: Alpha(Opacity=80); background-image: none; background-color:#EEEEEE");
                $("select:disabled").parent().parent().children("label, .ui-selectonemenu-trigger").attr("style", "opacity: .80; filter: Alpha(Opacity=80); background-image: none; background-color:#EEEEEE");

                $("div[id*='buscarPanel_content']").attr("style", "padding:0px!important");

            });
            
        </script>
        
    </ui:define>
</ui:composition>

