<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui" >
    <ui:composition template="/template.xhtml"> 
        <ui:define name="title">
            <h:outputText value="#{bundleCitas.CitaLista_Title}" rendered="#{citasReservadasController.estado == 'BUSCAR'}" />
        </ui:define>
        <ui:define name="body">
            <div class="ui-fluid">
                <div class="ui-g">
                    <div class="ui-g-12">
                        
                        <h:form id="listForm" rendered="#{citasReservadasController.estado == 'BUSCAR'}" >
                    
                            <p:panel id="buscarPanel" header="#{bundleCitas.CitaLista_Busqueda}" style="margin-bottom:10px;" toggleable="true" toggleSpeed="500" widgetVar="panel" >
                                <div class="ui-g">
                                    <div class="ui-g-12 ui-md-6 ui-lg-4">
                                        <p:outputLabel value="#{bundleCitas.CitaLista_TipTram_Label}"/>
                                        <p:selectOneMenu value="#{citasReservadasController.tipoTramite}">
                                            <f:selectItem itemLabel="---" itemValue=""/>
                                            <f:selectItems var="item" itemValue="#{item}" itemLabel="#{item.nombre}" value="#{citasReservadasController.listaTramites}" />
                                        </p:selectOneMenu>
                                    </div>
                                    <div class="ui-g-12 ui-md-6 ui-lg-1">
                                        <p:outputLabel value="#{bundleCitas.CitaLista_FecIni_Label}" />
                                        <p:calendar value="#{citasReservadasController.filtroBandejaFecIni}" locale="es"
                                                    showOn="button"
                                                    readonlyInput="true"
                                                    pattern="#{bundleCitas.FormatoFecha}">
                                            <f:convertDateTime pattern="#{bundleCitas.FormatoFecha}" />
                                        </p:calendar>
                                    </div>

                                    <div class="ui-g-12 ui-md-6 ui-lg-1">
                                        <p:outputLabel value="#{bundleCitas.CitaLista_FecFin_Label}" />
                                        <p:calendar value="#{citasReservadasController.filtroBandejaFecFin}" locale="es"
                                                    showOn="button"
                                                    readonlyInput="true"
                                                    pattern="#{bundleCitas.FormatoFecha}">
                                            <f:convertDateTime pattern="#{bundleCitas.FormatoFecha}" />
                                        </p:calendar>                                
                                    </div>

                                    <div class="ui-g-12 ui-md-6 ui-lg-1">
                                        <p:outputLabel value="&nbsp;" />
                                        <p:commandButton value="#{bundleCitas.Buscar}" id="botonBuscar"
                                                         process="@this, buscarPanel"
                                                         icon="ui-icon-search " actionListener="#{citasReservadasController.buscarBandeja()}" oncomplete="completeFind();"
                                                         update="buscarDatatableRegistro"/>
                                    </div>


                                </div>
                                <p:blockUI block="buscarPanel" trigger="botonBuscar" />
                            </p:panel>
                    
                            <p:dataTable id="buscarDatatableRegistro" value="#{citasReservadasController.lstCitas}"
                                    var="itemReg" 
                                    emptyMessage="#{bundleCitas.MensajeNoResultados}" 
                                    paginator="true" rows="#{bundleCitas.PaginatorFilas}"  
                                    paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"  
                                    rowsPerPageTemplate="#{bundleCitas.PaginatorFilasPorPagina}"
                                    rowIndexVar="idExp"
                                    reflow="true"
                                >
                                
                                <p:column headerText="TRÁMITE" style="font-size:95%!important" class="ui-lg-3" >
                                    <h:outputText value="#{itemReg.tipoTramiteId.nombre}"/>
                                    <h:outputText value=" - #{itemReg.subTramiteId.nombre}" rendered="#{itemReg.subTramiteId!=null}"/>
                                </p:column>
                                <p:column headerText="SEDE" style="font-size:95%!important" class="ui-lg-2" >
                                    <h:outputText value="#{itemReg.tipoSedeId.nombre}"/>
                                </p:column>
                                <ui:remove>
                                <p:column headerText="#{bundleCitas.CitaLista_tblNroCon_Title}" style="font-size:95%!important" >
                                    <h:outputText value="#{itemReg.claveConsulta}" />
                                </p:column>
                                </ui:remove>
                                
                                <p:column headerText="FECHA HORA DE CITA" style="font-size:95%!important" class="ui-lg-1">
                                    <h:outputText value="#{itemReg.fechaTurno}">
                                        <f:convertDateTime pattern="#{bundleCitas.FormatoFecha}" />
                                    </h:outputText>                            
                                    <h:outputText value=" #{citasReservadasController.mostrarHora(itemReg)}" />
                                </p:column>
                                <p:column headerText="ESTADO" style="font-size:95%!important" class="ui-lg-1">
                                    <h:outputText value="#{itemReg.estado.nombre}"/>                            
                                </p:column>
                                <p:column headerText="CONSTANCIA" style="font-size:95%!important" class="ui-lg-1" >
                                    <p:commandButton  id="botonFormulario" icon="ui-icon-print" 
                                                      ajax="false"
                                                      process="@this" 
                                                      partialSubmit="true"                              
                                                      onclick="this.form.target = '_blank'" 
                                                      onblur="this.form.target = '_self'"
                                                      immediate="true" rendered="#{citasReservadasController.verImprimirConstancia(itemReg)}">
                                        <p:fileDownload value="#{citasReservadasController.verConstanciaValPdf(itemReg)}" contentDisposition="inline"  />
                                    </p:commandButton>
                                    <ui:remove>
                                    <p:commandButton update="@this"
                                                     icon="ui-icon-print" 
                                                     actionListener="#{citasReservadasController.mostrarVerCita(itemReg)}" 
                                                     rendered="#{itemReg.tipoTramiteId.codProg=='TP_TRAM_VER' and itemReg.atendido==1}"
                                                     >
                                    </p:commandButton>
                                    </ui:remove>
                                    <p:commandButton process="@this"
                                                     icon="ui-icon-print"
                                                     actionListener="#{citasReservadasController.mostrarVerCita(itemReg)}" 
                                                     rendered="#{citasReservadasController.rendererVerPdfVeri(itemReg)}"
                                                     title="Ver registro Verificación" >
                                    </p:commandButton>                                    
                                    <p:commandButton  icon="ui-icon-print" class="btnSelect"
                                                      ajax="false"
                                                      process="@this" 
                                                      partialSubmit="true"                              
                                                      onclick="this.form.target = '_blank'" 
                                                      onblur="this.form.target = '_self'"
                                                      rendered="#{citasReservadasController.rendererVerPdfVeriRen(itemReg)}"
                                                      title="Ver constancia"
                                                      immediate="true" >
                                        <p:fileDownload value="#{citasReservadasController.verConstanciaValPdf(itemReg)}" contentDisposition="inline"  />
                                    </p:commandButton>                                    
                                    
                                </p:column>
                                <p:column headerText="OPCIÓN" style="font-size:95%!important" class="ui-lg-1" >  
                                    <p:commandButton update="@this"
                                                     icon="ui-icon-search" 
                                                     actionListener="#{citasReservadasController.mostrarVerCita(itemReg)}" 
                                                     value="#{bundleCitas.Ver}" >
                                    </p:commandButton>
                                    
                                    <p:commandButton update="@form"
                                                     icon="ui-icon-trash"
                                                     value="Cancelar"
                                                     styleClass="botonBorrar"
                                                     rendered="#{citasReservadasController.renderBtnCancelarCitaReservada(itemReg)}"
                                                     actionListener="#{citasReservadasController.cancelarCitaReservada(itemReg)}"
                                                     title="Cancela Cita Reservada">
                                        <p:confirm header="Confirmar Cancelación de cita Reservada" message="¿Confirma que desea Cancelar la cita Reservada?" icon="ui-icon-alert" />
                                    </p:commandButton>
                                    
                                </p:column>
                            </p:dataTable>

                        </h:form>
                    </div>
                </div>

            </div>
            <ui:include src="DlgVerCitaVal.xhtml"/>
            <ui:include src="DlgVerCitaPol.xhtml"/>
            <ui:include src="DlgVerCitaVer.xhtml"/>
            <ui:include src="DlgVerCitaTram.xhtml"/>
            <ui:include src="DlgVerCitaEmpadronamiento.xhtml"/>
            
            <script type="text/javascript">
                function completeFind(){
                    $("div[id*='buscarPanel_content']").attr("style", "padding:0!important");
                }
                
                $(document).ready(function() { 
                    //$(".ui-dialog-titlebar").attr("style", "padding:8px!important; margin:0!important");
                    $(".txtLabel").parent().attr("style", "padding-top:11px");
                    $(".ui-layout-unit-header").attr("style", "border: 1px solid #1f89ce; color: #fff; background: #2399e5;");
                    $(".ui-state-disabled").attr("style", "opacity: .80; filter: Alpha(Opacity=80); background-image: none;");
                    $("textarea:disabled").attr("style", "opacity: .80; filter: Alpha(Opacity=80); background-image: none; background-color:#EEEEEE");
                    $("select:disabled").parent().parent().children("label, .ui-selectonemenu-trigger").attr("style", "opacity: .80; filter: Alpha(Opacity=80); background-image: none; background-color:#EEEEEE");

                    $("div[id*='buscarPanel_content']").attr("style", "padding:2px!important");
                    
                    //$("#evaluarContratoForm").children().children().children().children(".ui-g").children().attr("style", "padding:3px!important;");
                    $("div[id*='panelVerResumen_content'], div[id*='panelVerDatGen_content'], div[id*='panelVerDatArm_content']").attr("style", "padding:0!important");
                    $("div[id*='panelVerResumen_content'], div[id*='panelVerDatGen_content'], div[id*='panelVerDatArm_content']").children(".ui-g").children().attr("style", "padding:3px!important;");
                });
                
            </script>
            
        </ui:define>        
    </ui:composition>
</html>
