<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions" >

    <ui:composition template="/template.xhtml"> 
        <ui:define name="title">
            <h:outputText value="#{BundleBDIntegrado.EppCertificadoTitulo_ListadoInscritos}" rendered="#{eppCertificadoController.estado == 'BUSCAR'}"/>
        </ui:define>
        <ui:define name="body">
            <h:form id="listBand" rendered="#{eppCertificadoController.estado == 'BUSCAR'}" >
                <p:panel header="Busqueda" id="panBusqueda" >
                    <h:panelGrid columns="1" id="pnlgBusqueda" >
                            <p:fieldset legend="#{BundleBDIntegrado.EppCertificado_criterioBusq}" >
                                
                                <h:panelGrid columns="2" id="pnlCapacitacion">
                                    <p:outputLabel value="#{BundleBDIntegrado.EppCertificado_capacitacionProg}" for="bus"/> 
                                    
                                    <p:selectOneMenu id="lugarFecha"
                                                     autoWidth="false"
                                                     style="width: 450px;"
                                                     value="#{eppCertificadoController.capacitacion }" >
                                       <f:selectItem itemLabel="---" itemValue="#{null}"/>
                                       <f:selectItems var="item" itemValue="#{item}" itemLabel="#{eppCertificadoController.obtenerLugarFechaCertificacionesConstancia(item)}"
                                                      value="#{eppCertificadoController.itemsCapacitacionCertificadoMS}"/>
                                       <p:ajax event="change" update="@this" process="@this" />
                                   </p:selectOneMenu>                                    
                                </h:panelGrid>
                                <br/>
                                <h:panelGrid columns="2" id="pnlFiltro">
                                    <h:panelGrid columns="5" >
                                        <p:outputLabel value="#{BundleBDIntegrado.EppCertificado_rangoFecha}"/>
                                        <p:outputLabel value=""/>
                                        <p:outputLabel value=""/>
                                        <p:outputLabel value=""/>
                                        <p:outputLabel value=""/>
                                        
                                        <p:calendar id="fechaInicio"
                                                    locale="es"
                                                    showOn="button" value="#{eppCertificadoController.fechaInicio }"
                                                    pattern="#{BundleBDIntegrado.FormatoFecha}" >  
                                                <f:convertDateTime pattern="#{BundleBDIntegrado.FormatoFecha}" />
                                        </p:calendar>
                                        <pe:tooltip for="fechaInicio"
                                                    value="Ingrese la fecha de inicio de búsqueda" 
                                                    showEffect="slideToggle"  
                                                    hideEffect="slideToggle" 
                                                    showDelay="0" 
                                                    myPosition="left center" 
                                                    atPosition="right center"/>  
                                        <p:outputLabel value="al"/>
                                        <p:calendar id="fechaFin"
                                                    locale="es"
                                                    showOn="button" value="#{eppCertificadoController.fechaFin }"
                                                    pattern="#{BundleBDIntegrado.FormatoFecha}" >  
                                                <f:convertDateTime pattern="#{BundleBDIntegrado.FormatoFecha}" />
                                        </p:calendar>
                                        <pe:tooltip for="fechaFin"
                                                    value="Ingrese la fecha final de búsqueda" 
                                                    showEffect="slideToggle"  
                                                    hideEffect="slideToggle" 
                                                    showDelay="0" 
                                                    myPosition="left center" 
                                                    atPosition="right center"/> 
                                        
                                    </h:panelGrid>
                                    
                                    <h:panelGrid columns="3" >
                                        <p:outputLabel value="#{BundleBDIntegrado.EppCertificado_buscarpor}" for="bus"/>
                                        <p:outputLabel value=""/>
                                        <p:outputLabel value=""/>
                                        
                                        <p:selectOneMenu id="bus" value="#{eppCertificadoController.tipoBusqueda}"  >
                                            <f:selectItem itemValue="#{null}" itemLabel="------"/>
                                            <f:selectItem itemValue="1" itemLabel="APELLIDOS Y NOMBRES" />
                                            <f:selectItem itemValue="2" itemLabel="NRO. DOCUMENTO" />
                                            <f:selectItem itemValue="3" itemLabel="RESULTADO DE LA CAPACITACION" />
                                            <p:ajax event="change" update="@this,pnlBusquedaCriterio" listener="#{eppCertificadoController.cambiaResultadoBusqueda()}" />
                                        </p:selectOneMenu>
                                        <h:panelGrid columns="2" id="pnlBusquedaCriterio">
                                            <p:inputText value="#{eppCertificadoController.filtro}" rendered="#{!eppCertificadoController.muestraBusquedafecha}" id="filtroBusqueda" />
                                            <pe:tooltip for="filtroBusqueda"                                                        value="Ingrese el criterio de búsqueda" 
                                                        showEffect="slideToggle"  
                                                        hideEffect="slideToggle" 
                                                        showDelay="0" 
                                                        myPosition="left center" 
                                                        atPosition="right center"/> 
                                            
                                            <p:selectOneMenu id="result" value="#{eppCertificadoController.tipoResultado}"  rendered="#{eppCertificadoController.muestraBusquedafecha}" >
                                                <f:selectItem itemValue="#{null}" itemLabel="------"/>                                                
                                                <f:selectItem itemValue="APROBADO" itemLabel="APROBADO" />
                                                <f:selectItem itemValue="DESAPROBADO" itemLabel="DESAPROBADO" />                                                
                                                <p:ajax event="change" update="@this" process="@this" />
                                            </p:selectOneMenu>
                                        </h:panelGrid>
                                        <p:commandButton value="#{BundleBDIntegrado.Buscar}" 
                                                     process="@this,pnlgBusqueda"
                                                     icon="ui-icon-search " actionListener="#{eppCertificadoController.buscarBandeja()}" 
                                                     update="@form"/>  
                                    </h:panelGrid>
                                </h:panelGrid>
     
                            </p:fieldset>
                    </h:panelGrid>
                    <br/>
                    <p:commandButton value="#{BundleBDIntegrado.EppCertificado_btnInscribir}"
                                         actionListener="#{eppCertificadoController.openDlgDeclaracionInscripcion()}"
                                         process="@this" />
                    <br/><br/>
                    <p:dataTable id="buscarDatatableRegistro" value="#{eppCertificadoController.resultadosBandeja}"
                                 var="itemReg"
                                 rowKey="#{itemReg.id}"
                                 selection="#{eppCertificadoController.listEppRegistroSelec}"                                                   
                                 emptyMessage="#{BundleBDIntegrado.MensajeNoResultados}" 
                                 paginator="true" rows="#{BundleBDIntegrado.PaginatorFilas}"  
                                 paginatorTemplate="{CurrentPageReport}  {FirstPageLink} 
                                 {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} 
                                 {RowsPerPageDropdown}"
                                 rowsPerPageTemplate="#{BundleBDIntegrado.PaginatorFilasPorPagina}">                    
                        <p:column selectionMode="multiple" style="width:16px;text-align:center" rendered="true" visible="#{itemReg.tipoReg == 2}" />
                        <p:column rendered="true" visible="#{itemReg.tipoReg != 2}" style="width:16px;text-align:center" />
                        <p:column headerText="#{BundleBDIntegrado.EppCertificado_dtBandeja_id}" sortBy="#{itemReg.id}" style="text-align: center;" >                               
                            <h:outputText value="#{itemReg.id}" />
                        </p:column>
                        <p:column headerText="#{BundleBDIntegrado.EppCertificado_dtBandeja_Participante}" style="text-align: center;" >                            
                            <h:outputText value="#{itemReg.apePat.concat(' ').concat(itemReg.apeMat).concat(' ').concat(itemReg.nombres) }"/>
                        </p:column>
                        <p:column headerText="#{BundleBDIntegrado.EppCertificado_dtBandeja_numDocumento}" style="text-align: center;" >
                            <h:outputText value="#{itemReg.numDoc}"/><br/>
                        </p:column>
                        <p:column headerText="#{BundleBDIntegrado.EppCertificado_dtBandeja_fechaInscrip}" style="text-align: center;" >
                            <h:outputText value="#{itemReg.fecha}">
                                <f:convertDateTime pattern="#{BundleBDIntegrado.FormatoFecha}" />
                            </h:outputText>
                        </p:column>
                        <p:column headerText="#{BundleBDIntegrado.EppCertificado_dtBandeja_lugarFecha}" style="text-align: center;" >
                            <h:outputText value="#{eppCertificadoController.obtenerLugarFechaCertificacionesMS(itemReg)}"/><br/>
                        </p:column>
                        <p:column headerText="#{BundleBDIntegrado.EppCertificado_dtBandeja_expediente}" style="text-align: center;" >
                            <h:outputText value="#{itemReg.nroExpediente}"/><br/>
                        </p:column>                        
                        <p:column headerText="#{BundleBDIntegrado.EppCertificado_dtBandeja_resultado}" style="text-align: center;" >                               
                            <h:outputText value="#{eppCertificadoController.formatoResultadoCap(itemReg) }"/>                            
                        </p:column>
                        <p:column headerText="#{BundleBDIntegrado.EppCertificado_dtBandeja_accion}" style="text-align: center;">  
                            <p:commandButton  id="botonReporteD" icon="ui-icon-print" 
                                              rendered="#{itemReg.tipoReg == 1}"
                                              ajax="false" 
                                              value="Ver Constancia"
                                              partialSubmit="true"                              
                                              onclick="this.form.target = '_blank'" 
                                              onblur="this.form.target = '_self'" 
                                              immediate="true" >
                                <p:fileDownload value="#{eppCertificadoController.constanciaListado(itemReg)}" contentDisposition="inline"  />
                            </p:commandButton>    
                        </p:column>
                    </p:dataTable>
                </p:panel>                    
            </h:form>
            
            <ui:include src="dlgConfirmarInscripcion.xhtml"/>
            <ui:include src="dlgAyuda.xhtml"/>
            <ui:include src="dlgBuscarPersona.xhtml"/>
            <ui:include src="dlgNuevaPersona.xhtml"/>
            <ui:include src="dlgDni.xhtml"/>
        </ui:define>
    </ui:composition>

</html>