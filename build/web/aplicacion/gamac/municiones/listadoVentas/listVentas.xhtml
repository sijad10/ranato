<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pe="http://primefaces.org/ui/extensions">

    <ui:define name="title">
        <f:facet name="header" >
            SUCAMEC EN L√çNEA - SEL
        </f:facet>
        
        <h:outputText value="#{bundleGamacCVMuni.listVentasTitle}"/>
    </ui:define>

    <ui:define name="body">

        <div class="ui-fluid">
            <div class="ui-g">
                <div class="ui-g-12">
                    <p>#{bundleGamacCVMuni.listVentasIntro}</p>
                    <h:form id="buscarForm">
                        <p:focus context="buscarForm" />
                        <p:defaultCommand target="botonBuscar"/>

                        <p:panel id="buscarPanel" header="#{bundleGamacCVMuni.listVentasPanelBusTitle}" style="margin-bottom:10px;" toggleable="true" toggleSpeed="500" widgetVar="panel" >
                            <div class="ui-g">
                                <div class="ui-g-12 ui-md-2 ui-lg-1">
                                    <p:outputLabel for="tipoFiltro" value="#{bundleGamacCVMuni.listVentasBusTipoFiltro_Label}" styleClass="txtLabel"/>
                                </div>
                                <div class="ui-g-12 ui-md-3 ui-lg-2">
                                    <p:selectOneMenu id="tipoFiltro" value="#{gamacMunicionesListadoVentasController.tipoFiltro}"  >
                                        <f:selectItem itemValue="#{null}" itemLabel="------"/>
                                        <f:selectItem itemValue="1" itemLabel="RUC O DNI DEL VENDEDOR" />
                                        <f:selectItem itemValue="2" itemLabel="NOMBRE COMPRADOR" />
                                        <f:selectItem itemValue="3" itemLabel="FECHA VENTA" />
                                        <f:selectItem itemValue="4" itemLabel="LOCAL DE VENTA" />                                        
                                    </p:selectOneMenu>
                                </div>

                                <div class="ui-g-12 ui-md-3 ui-lg-3 ui-helper-hidden tipo1">
                                    <p:inputText id="filtroBusqueda" size="20" value="#{gamacMunicionesListadoVentasController.filtro}" requiredMessage="Ingresar texto a filtrar" autocomplete="false"/>
                                </div>

                                <div class="ui-g-12 ui-md-2 ui-lg-3 ui-helper-hidden tipo2" >
                                    <p:calendar id="findFecha" value="#{gamacMunicionesListadoVentasController.findFechaVenta}"
                                                size="10" autocomplete="false" 
                                                pattern="#{bundleGamacCVMuni.FormatoFecha}" navigator="true" locale="es" showOn="button">
                                    </p:calendar>
                                </div>
                                
                                <div class="ui-g-12 ui-md-6 ui-lg-3 ui-helper-hidden tipo3" >
                                    <p:selectOneMenu id="findLocal" value="#{gamacMunicionesListadoVentasController.findLocal}" >
                                        <f:selectItem itemValue="#{null}" itemLabel="------"/> 
                                        <f:selectItems value="#{gamacMunicionesListadoVentasController.listDire()}" var="item" itemValue="#{item}"
                                                       itemLabel="#{item.direccion} #{item.numero}, #{item.distritoId.nombre} - #{item.distritoId.provinciaId.nombre} - #{item.distritoId.provinciaId.departamentoId.nombre}" /> 
                                        <p:ajax event="change" update="@none" process="@this" partialSubmit="true"/>
                                    </p:selectOneMenu>
                                </div>
                                
                                <div class="ui-g-12 ui-md-6 ui-lg-1">
                                    <p:commandButton value="#{bundleGamacCVMuni.listVentasBusBtnBuscar_Label}" id="botonBuscar"
                                                     process="@this, tipoFiltro, filtroBusqueda, findFecha, findLocal"
                                                     icon="ui-icon-search " actionListener="#{gamacMunicionesListadoVentasController.buscar}" 
                                                     update=":buscarForm:buscarDatatable"/>
                                </div>

                                <div class="ui-g-12 ui-md-12 ui-lg-1">
                                </div>
                                
                                <div class="ui-g-12 ui-md-6 ui-lg-2">
                                    <p:commandButton value="#{bundleGamacCVMuni.listVentasBusBtnRegistrarVenUF_Label}"
                                                     action="#{gamacMunicionesRegistrarVentaController.prepareRegistro()}" id="btnCreate" icon="ui-icon-plus"
                                                     process="@this" update="@form"
                                                     partialSubmit="true" >
                                    </p:commandButton>
                                </div>
                                
                                <div class="ui-g-12 ui-md-6 ui-lg-2">
                                    <p:commandButton value="#{bundleGamacCVMuni.listVentasBusBtnRegistrarVen_Label}"
                                                     actionListener="#{gamacMunicionesListadoVentasController.newRegistroVenta()}" id="btnCrate" icon="ui-icon-plus"
                                                     process="@this" update=""
                                                     partialSubmit="true" oncomplete="createVenta();" >
                                    </p:commandButton>
                                </div>

                            </div>

                            <p:blockUI block="buscarPanel" trigger="botonBuscar" />
                        </p:panel>                        
                        
                        <p:dataTable id="buscarDatatable" value="#{gamacMunicionesListadoVentasController.lstVentas}"
                                     var="item"
                                     rowKey="#{item.id}"
                                     emptyMessage="#{bundleGamacCVMuni.MensajeNoResultados}" 
                                     paginator="true" rows="#{bundleGamacCVMuni.PaginatorFilas}"  
                                     paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"  
                                     rowsPerPageTemplate="#{bundleGamacCVMuni.PaginatorFilasPorPagina}"
                                     rowIndexVar="idExp"
                                     reflow="true">
                            
                            <f:facet name="header">
                                <h:outputLabel value="#{bundleGamacCVMuni.Resultados}" />
                            </f:facet>
                            <p:column headerText="#{bundleGamacCVMuni.listVentasDTLocalCom_Title}" style="font-size:92%!important" class="ui-lg-2">
                                <f:facet name="header">
                                    <h:outputText value="#{bundleGamacCVMuni.listVentasDTLocalCom_Title}" />
                                </f:facet>
                                <h:outputText value="#{item.direccion}"/>
                                <h:inputHidden id="idVenta" value="#{item.id}"/>                                
                            </p:column>

                            <p:column headerText="#{bundleGamacCVMuni.listVentasDTTipoNroDoc_Title}" style="font-size:92%!important" class="ui-lg-1">
                                <f:facet name="header">
                                    <h:outputText value="#{bundleGamacCVMuni.listVentasDTTipoNroDoc_Title}" />
                                </f:facet>
                                <h:outputText value="#{item.tipoDoc} #{item.nroDoc}"/>
                            </p:column>
                            
                            <p:column headerText="#{bundleGamacCVMuni.listVentasDTTipoComp_Title}" style="font-size:92%!important" class="ui-lg-1">
                                <f:facet name="header">
                                    <h:outputText value="#{bundleGamacCVMuni.listVentasDTTipoComp_Title}" />
                                </f:facet>
                                <h:outputText value="#{item.tipoComprador}"/>
                            </p:column>
                            
                            <p:column headerText="#{bundleGamacCVMuni.listVentasDTComprador_Title}" style="font-size:92%!important" class="ui-lg-1">
                                <f:facet name="header">
                                    <h:outputText value="#{bundleGamacCVMuni.listVentasDTComprador_Title}" />
                                </f:facet>
                                <h:outputText value="#{item.compradorNombre}"/>
                            </p:column>
                            
                            <p:column headerText="#{bundleGamacCVMuni.listVentasDTTipoAut_Title}" style="font-size:92%!important" class="ui-lg-1">
                                <f:facet name="header">
                                    <h:outputText value="#{bundleGamacCVMuni.listVentasDTTipoAut_Title}" />
                                </f:facet>
                                <h:outputText value="#{item.tipoAutorizacion}"/>
                            </p:column>
                            
                            <p:column headerText="#{bundleGamacCVMuni.listVentasDTNroAut_Title}" style="font-size:92%!important" class="ui-lg-1">
                                <f:facet name="header">
                                    <h:outputText value="#{bundleGamacCVMuni.listVentasDTNroAut_Title}" />
                                </f:facet>
                                <h:outputText value="#{item.nroAutorizacion}"/>
                            </p:column>
                            
                            <p:column headerText="#{bundleGamacCVMuni.listVentasDTTpTransac_Title}" style="font-size:92%!important" class="ui-lg-1">
                                <f:facet name="header">
                                    <h:outputText value="#{bundleGamacCVMuni.listVentasDTTpTransac_Title}" />
                                </f:facet>
                                <h:outputText value="#{item.tipoTransaccion}"/>
                            </p:column>
                            
                            <p:column headerText="#{bundleGamacCVMuni.listVentasDTFechaVen_Title}" style="font-size:92%!important" class="ui-lg-1">
                                <f:facet name="header">
                                    <h:outputText value="#{bundleGamacCVMuni.listVentasDTFechaVen_Title}" />
                                </f:facet>
                                <h:outputText value="#{item.fechaVenta}">
                                    <f:convertDateTime pattern="#{bundleGamacCVMuni.FormatoFecha}" />
                                </h:outputText>
                            </p:column>

                            <p:column headerText="#{bundleGamacCVMuni.listVentasDTTotalMuni_Title}" style="font-size:92%!important" class="ui-lg-1">
                                <f:facet name="header">
                                    <h:outputText value="#{bundleGamacCVMuni.listVentasDTTotalMuni_Title}" />
                                </f:facet>
                                <h:outputText value="#{item.totalMuniciones}"/>                                
                            </p:column>

                            <p:column headerText="#{bundleGamacCVMuni.listVentasDTResponsable_Title}" style="font-size:92%!important" class="ui-lg-1">
                                <f:facet name="header">
                                    <h:outputText value="#{bundleGamacCVMuni.listVentasDTResponsable_Title}" />
                                </f:facet>
                                <h:outputText value="#{item.responsable}"/>                                
                            </p:column>
                            
                            <p:column headerText="#{bundleGamacCVMuni.listVentasDTAcciones_Title}" style="font-size:92%!important" class="ui-lg-1">
                                <f:facet name="header">
                                    <h:outputText value="#{bundleGamacCVMuni.listVentasDTAcciones_Title}" />
                                </f:facet>
                                <p:column style="margin: 0!important; padding: 0!important" >
                                    <p:commandLink actionListener="#{gamacMunicionesListadoVentasController.loadVerVenta}" process=":buscarForm:buscarDatatable"
                                                   oncomplete="verVenta()" partialSubmit="true" >
                                        <h:outputText styleClass="ui-icon ui-icon-search" style="margin:0; display: inline-block;" title="Ver Detalle" />
                                    </p:commandLink>
                                </p:column>&nbsp;
                                <p:column style="margin: 0!important; padding: 0!important" rendered="#{item.cierreInventario==1 and item.isCancelable ==true}">
                                    <p:commandLink actionListener="#{gamacMunicionesListadoVentasController.loadAnularVenta}" process=":buscarForm:buscarDatatable"
                                                   partialSubmit="true" >
                                        <h:outputText styleClass="ui-icon ui-icon-cancel" style="margin:0; display: inline-block;" title="Anular venta" />
                                        <p:confirm header="#{bundleGamacCVMuni.ConfirmarTitulo}" message="#{bundleGamacCVMuni.ConfirmarAnularRegVenta}" icon="ui-icon-alert" />
                                    </p:commandLink>
                                </p:column>&nbsp;
                                <p:column style="margin: 0!important; padding: 0!important">
                                    <p:commandLink actionListener="#{gamacMunicionesListadoVentasController.loadDevolVenta}" process=":buscarForm:buscarDatatable"
                                                   oncomplete="createDevolucion()"
                                                   partialSubmit="true" >
                                        <h:outputText styleClass="ui-icon ui-icon-arrowreturnthick-1-w" style="margin:0; display: inline-block;" title="Devolver venta" />
                                        <p:confirm header="#{bundleGamacCVMuni.ConfirmarTitulo}" message="#{bundleGamacCVMuni.ConfirmarDevolverRegVenta}" icon="ui-icon-alert" />
                                    </p:commandLink>
                                </p:column>&nbsp;
                                
                            </p:column>
                            
                        </p:dataTable>
                        
                        <p:blockUI block="buscarDatatable" trigger="buscarDatatable" >
                            CARGANDO<br />
                            <p:graphicImage url="/resources/imagenes/ajaxloadingbar.gif"/>
                        </p:blockUI>                          
                    </h:form>
                </div>
            </div>
        </div>
                     
        <ui:include src="DlgCreateVenta.xhtml" />
        <ui:include src="DlgViewVenta.xhtml" />
        <ui:include src="DlgDevolucion.xhtml" />
        
        <script type="text/javascript">
            //$(".tipo1").show();
            $(".txtLabel").parent().attr("style", "padding-top:11px");
            //$(".ui-dialog-titlebar").attr("style", "padding:8px!important; margin:0!important");
            $(".ui-layout-unit-header").attr("style", "border: 1px solid #1f89ce; color: #fff; background: #2399e5;");
            $("div[id*='buscarPanel_content']").attr("style", "padding:0!important");

            $("select[id*='tipoFiltro']").on("change", function () {
                $(".tipo1, .tipo2, .tipo3").hide();
                valorTipo = $(this).val();
                console.log("$(tipoFiltro).val(): " + $(this).val());
                switch (valorTipo) {                   
                    case '1':
                    case '2':
                        $(".tipo1").show();
                        break;
                    case '3':
                        $(".tipo2").show();
                        break;
                    case '4':
                        $(".tipo3").show();
                        break;                       
                }
            });

            function createVenta() {
                //PF('newVentaDialog').show();
                $("#newVenta > .ui-dialog-titlebar ").attr("style", "margin:0!important; padding: 6px!important; color: #fff!important; background: #2399e5!important;");
                $("#newVenta_title").attr("style", "color: #fff!important; font-size:100%!important; padding:0!important;");                
                //$("#newVenta > .ui-dialog-content").attr("style", "padding:4px!important; border-width:0 5px 5px 5px!important; border-style:solid!important; border-color: #2399e5!important;");
                $("#newVenta > .ui-dialog-content").attr("style", "padding:4px!important;");
                $("div[id*='datosMunicPanel_content'], div[id*='datosVentaPanel_content']").attr("style", "padding:2px!important");
                $(".txtLabel").parent().attr("style", "padding-top:11px");
                setTimeout(function () {
                    $("div[id*='datosMunicPanel_content'], div[id*='datosVentaPanel_content']").attr("style", "padding:2px!important");
                    $(".ui-datatable-footer").attr("style", "padding:2px!important");
                }, 300);
                
            }
            
            function createDevolucion() {
                $("#devMunicion > .ui-dialog-titlebar ").attr("style", "margin:0!important; padding: 6px!important; color: #fff!important; background: #2399e5!important;");
                $("#devMunicion_title").attr("style", "color: #fff!important; font-size:100%!important; padding:0!important;");                
                $("#devMunicion > .ui-dialog-content").attr("style", "padding:4px!important;");
            }

            function verVenta() {
                //PF('newVentaDialog').show();
                $("#viewVenta > .ui-dialog-titlebar ").attr("style", "margin:0!important; padding: 6px!important; color: #fff!important; background: #2399e5!important;");
                $("#viewVenta_title").attr("style", "color: #fff!important; font-size:100%!important; padding:0!important;");                
                //$("#viewVenta > .ui-dialog-content").attr("style", "padding:4px!important; border-width:0 5px 5px 5px!important; border-style:solid!important; border-color: #2399e5!important;");
                $("#viewVenta > .ui-dialog-content").attr("style", "padding:4px!important;");
                $("div[id*='datosMunicPanel_content'], div[id*='datosVentaPanel_content']").attr("style", "padding:2px!important");
                $(".txtLabel").parent().attr("style", "padding-top:11px");
                setTimeout(function () {
                    $("div[id*='datosMunicPanel_content'], div[id*='datosVentaPanel_content']").attr("style", "padding:2px!important");
                    $(".ui-datatable-footer").attr("style", "padding:2px!important");
                    $("#viewVenta").css('top', 30);                    
                }, 300);
                
            }

            function updateDialogInicio() {
                $("#newVenta").css('top', 30);
            }

            function updateDialogInicioHide() {
                document.getElementById("newVentaForm").reset();
                $('#newVentaForm').trigger("reset");
            }

        </script>
        
    </ui:define>
</ui:composition>
