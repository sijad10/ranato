<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pe="http://primefaces.org/ui/extensions">
    
        <h:form id="ceseForm" rendered="#{sspCarneController.estado == 'CESE'}" >
            <br/>
            <p:wizard id="wizard" showNavBar="false" step="#{sspCarneController.paso }" >
                    <p:tab id="paso1" title="#{BundleBDIntegrado.GsspSolicitudCese_1erPaso}" rendered="false" >
                        <p:panel id="pnlComprobantePago" >
                            <br/>
                            <h:panelGrid columns="1"  >
                                <h:outputText value="#{BundleBDIntegrado.GsspSolicitudCese_Paso1_nota1}" style="color:red; font-style: italic;" />
                            
                                <h:panelGrid columns="2">
                                    <h:outputText value="#{BundleBDIntegrado.GsspSolicitudCese_Paso1_nota1_2}" style="color:red; font-style: italic;" />
                                    <p:commandButton value="Ayuda" 
                                         partialSubmit="true" 
                                         process="@this" 
                                         actionListener="#{sspCarneController.openDlgAyuda()}" />
                                </h:panelGrid>
                                
                                <h:outputText value="#{BundleBDIntegrado.GsspSolicitudCese_Paso1_nota1_3}" style="color:red; font-style: italic;" />
                            </h:panelGrid>
                            <br/>

                            <p:fieldset legend="#{BundleBDIntegrado.GsspSolicitudCese_paso1_comprobante}" >
                                <h:panelGrid columns="1">
                                    <p:commandButton icon="ui-icon-search"  value="#{BundleBDIntegrado.GsspSolicitudCese_buscarComprobante}"
                                                         actionListener="#{sspCarneController.openDlgComprobante()}"
                                                         process="@this,wizard" update="@this,wizard"/>

                                    <p:dataTable id="tableComproPago" value="#{sspCarneController.lstRecibos }"
                                                 emptyMessage="#{BundleBDIntegrado.MensajeNoResultados}" var="itemComp" >

                                        <p:column headerText="#{BundleBDIntegrado.GsspSolicitudCese_dtComprobante_numero}" style="text-align:center" >
                                            <f:facet name="header">
                                                <h:outputText value="#{BundleBDIntegrado.GsspSolicitudCese_dtComprobante_numero}" />
                                            </f:facet>
                                            <h:outputText value="#{itemComp.nroSecuencia}"/>
                                        </p:column>
                                        <p:column headerText="#{BundleBDIntegrado.GsspSolicitudCese_dtComprobante_fecha}" style="text-align:center" >
                                            <f:facet name="header">
                                                <h:outputText value="#{BundleBDIntegrado.GsspSolicitudCese_dtComprobante_fecha}" />
                                            </f:facet>
                                            <h:outputText value="#{itemComp.fechaMovimiento}">
                                                <f:convertDateTime pattern="#{BundleBDIntegrado.FormatoFecha}" />
                                            </h:outputText>
                                        </p:column>
                                        <p:column headerText="#{BundleBDIntegrado.GsspSolicitudCese_dtComprobante_monto}" style="text-align:center" >
                                            <f:facet name="header">
                                                <h:outputText value="#{BundleBDIntegrado.GsspSolicitudCese_dtComprobante_monto}" />
                                            </f:facet>
                                            <h:outputText value="#{itemComp.importe}"/>
                                        </p:column>
                                    </p:dataTable>
                                    <br/>
                                    
                                </h:panelGrid>
                            </p:fieldset>
                            <br/>
                        </p:panel>
                        <br/>

                        <h:panelGrid columns="1">
                            <p:commandButton id="botonSiguiente1" icon="ui-icon-seek-next" iconPos="right" update="@all" actionListener="#{sspCarneController.siguiente('paso12')}" value="#{BundleBDIntegrado.GsspSolicitudCese_siguiente}" process="@this" partialSubmit="true" disabled="#{sspCarneController.disabledSiguiente}" />
                        </h:panelGrid>
                    </p:tab>

                    <p:tab id="paso2" title="#{BundleBDIntegrado.GsspSolicitudCese_2doPaso }" >
                        <p:panel id="pnlBusqueda" >
                            <br/>
                            <h:panelGrid columns="1">
                                <h:outputText value="#{BundleBDIntegrado.GsspSolicitudCese_paso2_nota1}" style="color:red; font-style: italic;" />
                                <h:outputText value="#{BundleBDIntegrado.GsspSolicitudCese_paso2_nota2}" style="color:red; font-style: italic;" />
                            </h:panelGrid>
                            <br/>
                            <h:panelGrid columns="7">
                                <h:outputText value="#{BundleBDIntegrado.GsspSolicitudCese_paso2_tipoDoc}" />
                                <p:selectOneMenu id="tipoDocBusqueda" value="#{sspCarneController.tipoDocSelected }" >
                                    <f:selectItem itemLabel="---" itemValue="#{null}"/>
                                    <f:selectItems var="item" itemValue="#{item}" itemLabel="#{item.nombre}" value="#{sspCarneController.listadoTipoDoc}"/>
                                    <p:ajax event="change" process="@this,pnlBusqueda" update="@this,pnlBusqueda" listener="#{sspCarneController.cambiarTipoDoc(false)}" />
                                </p:selectOneMenu>                                
                                <h:outputText value="#{BundleBDIntegrado.GsspSolicitudCese_paso2_numero}"  />
                                <p:inputText value="#{sspCarneController.numDoc}" id="numDocBusqueda" maxlength="#{sspCarneController.maxLength}" >
                                    <p:keyFilter mask="int" preventPaste="false" />
                                </p:inputText>
                                <pe:tooltip for="numDocBusqueda"
                                        value="Ingrese el número de documento"
                                        showEffect="slideToggle"
                                        hideEffect="slideToggle"
                                        showDelay="0"
                                        myPosition="left center"
                                        atPosition="right center"/>
                                <p:commandButton value="#{BundleBDIntegrado.Buscar}"
                                                 process="@this,wizard"
                                                 icon="ui-icon-search " actionListener="#{sspCarneController.buscarVigilanteCese()}" 
                                                 update="@this,wizard"/>
                                <p:commandButton value="#{BundleBDIntegrado.GsspSolicitudCese_Carga_Archivo}" 
                                         style="float: right; clear: both;"
                                         actionListener="#{sspCarneController.openDlgCargarArchivoCese()}" 
                                         oncomplete="PF('wvDlgFrmCeseMasivo').show();" 
                                         partialSubmit="true" 
                                         update=":frmCeseMasivo" 
                                         process="@this,@form"/>  
                                     
                            </h:panelGrid>
                            <br/>
                            <h:panelGrid columns="6"  >
                                <h:outputText value="#{BundleBDIntegrado.GsspSolicitudCese_paso2_tipoDoc}" style="display: block; width: 90px;"  />
                                <h:outputText id="tipoDoc" value="#{(sspCarneController.tipoDoc eq null)?'-':sspCarneController.tipoDoc}" style="font-weight: bold;" />
                                <h:outputText value="#{BundleBDIntegrado.GsspSolicitudCese_paso2_numero}" style="display: block; width: 90px;margin-left: 30px;" />
                                <h:outputText id="numDoc" value="#{sspCarneController.numDocView}" style="font-weight: bold;" />
                                <h:outputText value="#{BundleBDIntegrado.GsspSolicitudCese_paso2_nombresYApellidos}" style="display: block; width: 130px;margin-left: 30px;" />
                                <h:outputText id="nombres" value="#{sspCarneController.nombres} #{sspCarneController.apePat} #{sspCarneController.apeMat}" style="font-weight: bold;" />
                            </h:panelGrid>
                            
                            <h:panelGrid columns="4" >
                                <h:outputText value="#{BundleBDIntegrado.GsspSolicitudCese_paso2_modalidad}" style="display: block; width: 90px;" />
                                <p:selectOneMenu id="modalidad"
                                                style="width: 200px;"
                                                value="#{sspCarneController.modalidadSelected }"  >
                                    <f:selectItem itemLabel="---" itemValue="#{null}"/>
                                    <f:selectItems var="item" itemValue="#{item}" itemLabel="#{item.nombre}"
                                                      value="#{sspCarneController.lstModalidadesVig}"/>
                                    <p:ajax event="change" process="@this,pnlBusqueda" update="@this,pnlBusqueda" listener="#{sspCarneController.cambiaModalidad()}" />
                                </p:selectOneMenu>
                                <h:outputText value="#{BundleBDIntegrado.GsspSolicitudCese_paso2_carne}" style="margin-left: 30px;" />
                                <h:outputText id="carnet" value="#{(sspCarneController.carneSelected.nroCarne == 0?'-':sspCarneController.carneSelected.nroCarne)}" style="font-weight: bold;" />
                            </h:panelGrid>

                            <h:panelGrid columns="7"  >
                                <h:outputText value="#{BundleBDIntegrado.GsspSolicitudCese_paso2_fecEmision}" style="display: block; width: 90px;" />
                                <h:outputText id="fecEmision" value="#{(sspCarneController.carneSelected.fechaIni == null)?'-':sspCarneController.carneSelected.fechaIni}" style="font-weight: bold;" >
                                    <f:convertDateTime pattern="#{BundleBDIntegrado.FormatoFecha}" />
                                </h:outputText>
                                <h:outputText value="#{BundleBDIntegrado.GsspSolicitudCese_paso2_fecVencimiento}" style="margin-left: 30px;" />
                                <h:outputText value="-" />
                                <ui:remove>
                                    rfv - quitar remove y el outputlabel de arriba
                                    <h:outputText id="fecVencimiento" value="#{(sspCarneController.carneSelected.fechaFin == null)?'-':(sspCarneController.obtenerFechaFinCarne(sspCarneController.carneSelected.fechaFin))}" style="font-weight: bold;" />
                                </ui:remove>
                                <h:outputText value="#{BundleBDIntegrado.GsspSolicitudCese_paso2_estado}" style="margin-left: 30px;" />
                                <h:outputText id="estado" value="#{(sspCarneController.estadoCese == null)?'-':sspCarneController.estadoCese}" style="font-weight: bold;" />
                                <p:commandButton value="#{BundleBDIntegrado.Agregar}"
                                                 rendered="#{sspCarneController.renderDatosVigilante}"
                                                 process="@this,pnlBusqueda"
                                                 icon="ui-icon-plus" actionListener="#{sspCarneController.agregarVigilanteCese()}"
                                                 update="@this,pnlBusqueda"/>
                            </h:panelGrid>
                            <br/>
                            <h:panelGrid columns="1" >
                                <p:commandButton id="botonAnterior2" icon="ui-icon-seek-prev" iconPos="left" update="@all" actionListener="#{sspCarneController.siguiente('paso1')}" value="#{BundleBDIntegrado.GsspSolicitudCese_anterior}" process="@this" rendered="#{sspCarneController.solicitarRecibo}" />
                                <p:commandButton icon="ui-icon-newwin" process="@form" update="@form" actionListener="#{sspCarneController.validacionCese() }"  value="Procesar Cese" />
                            </h:panelGrid>
                            
                            <p:tabView dynamic="true" cache="false" id="tabGestion" widgetVar="wvTabGestion" style="margin-top: 8px!important; margin-bottom: 8px!important; padding: 0px;" >
                                <!--PANEL DE SELECCION DE CARNE PARA CESE-->
                                <p:tab id="tab1" title="Selección de Carne(s) para Cese">
                                    <p:panel class="panelTab">    
                                        <h:panelGrid columns="1">
                                            <h:panelGrid columns="1" style="border: 0px; width: 100%;" rendered="#{sspCarneController.lstVigilante != null }" >
                                                <h:commandLink style="float: right; clear: both;">
                                                    <p:graphicImage name="/icons/xls.png" width="32" alt="Excel"/>
                                                    <p:dataExporter type="xls" target="tableVigilantes" fileName="CesesSeleccionados" pageOnly="false" postProcessor="#{sspCarneController.postProcessXLS}"/>
                                                </h:commandLink>
                                            </h:panelGrid>
                                            <p:dataTable id="tableVigilantes" value="#{sspCarneController.lstVigilante}"
                                                         rowKey="#{item.ID}"
                                                         selection="#{sspCarneController.lstVigilanteSelect}"  
                                                         emptyMessage="#{BundleBDIntegrado.MensajeNoResultados}" var="item" 
                                                         paginator="true" rows="#{BundleBDIntegrado.PaginatorFilas}"  
                                                         paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink}
                                                         {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"  
                                                         rowsPerPageTemplate="#{BundleBDIntegrado.PaginatorFilasPorPagina}"
                                                         currentPageReportTemplate="{totalRecords} Carne(s) seleccionado(s)">
                                                <p:column selectionMode="multiple" style="width:5%;text-align:center" />
                                                <p:column headerText="#{BundleBDIntegrado.GsspSolicitudCese_dtVigilante_tipoDoc}" style="text-align:center" >
                                                    <f:facet name="header">
                                                        <h:outputText value="#{BundleBDIntegrado.GsspSolicitudCese_dtVigilante_tipoDoc}" />
                                                    </f:facet>
                                                    <h:outputText value="#{item.tipoDoc_desc}"/>
                                                </p:column>
                                                <p:column headerText="#{BundleBDIntegrado.GsspSolicitudCese_dtVigilante_nroDoc}" style="text-align:center" >
                                                    <f:facet name="header">
                                                        <h:outputText value="#{BundleBDIntegrado.GsspSolicitudCese_dtVigilante_nroDoc}" />
                                                    </f:facet>
                                                    <h:outputText value="#{item.numDoc_desc}"/>
                                                </p:column>
                                                <p:column headerText="#{BundleBDIntegrado.GsspSolicitudCese_dtVigilante_nombreYApellidos}" style="text-align:center" >
                                                    <f:facet name="header">
                                                        <h:outputText value="#{BundleBDIntegrado.GsspSolicitudCese_dtVigilante_nombreYApellidos}" />
                                                    </f:facet>
                                                    <h:outputText value="#{item.nombreYApellidos}"/>
                                                </p:column>
                                                <p:column headerText="#{BundleBDIntegrado.GsspSolicitudCese_dtVigilante_carnet}" style="text-align:center" >
                                                    <f:facet name="header">
                                                        <h:outputText value="#{BundleBDIntegrado.GsspSolicitudCese_dtVigilante_carnet}" />
                                                    </f:facet>
                                                    <h:outputText value="#{item.NRO_CRN_VIG}"/>
                                                </p:column>
                                                <p:column headerText="#{BundleBDIntegrado.GsspSolicitudCese_dtVigilante_modalidad}" style="text-align:center" >
                                                    <f:facet name="header">
                                                        <h:outputText value="#{BundleBDIntegrado.GsspSolicitudCese_dtVigilante_modalidad}" />
                                                    </f:facet>
                                                    <h:outputText value="#{item.DES_MOD}"/>
                                                </p:column>                                    
                                                <p:column headerText="#{BundleBDIntegrado.GsspSolicitudCese_dtVigilante_fecEmision}" style="text-align:center" >
                                                    <f:facet name="header">
                                                        <h:outputText value="#{BundleBDIntegrado.GsspSolicitudCese_dtVigilante_fecEmision}" />
                                                    </f:facet>
                                                    <h:outputText value="#{item.FEC_EMI}">
                                                        <f:convertDateTime pattern="#{BundleBDIntegrado.FormatoFecha}" />
                                                    </h:outputText>
                                                </p:column>
                                                <p:column headerText="#{BundleBDIntegrado.GsspSolicitudCese_dtVigilante_fecVencimiento}" style="text-align:center" >
                                                    <f:facet name="header">
                                                        <h:outputText value="#{BundleBDIntegrado.GsspSolicitudCese_dtVigilante_fecVencimiento}" />
                                                    </f:facet>
                                                    <ui:remove>
                                                        rfv - quitar remove
                                                        <h:outputText value="#{sspCarneController.obtenerFechaFinCarne(item.FEC_VENC)}" />
                                                     </ui:remove>
                                                </p:column>
                                                <p:column headerText="#{BundleBDIntegrado.GsspSolicitudCese_dtVigilante_estado}" style="text-align:center" >
                                                    <f:facet name="header">
                                                        <h:outputText value="#{BundleBDIntegrado.GsspSolicitudCese_dtVigilante_estado}" />
                                                    </f:facet>
                                                    <h:outputText value="#{item.estadoCese}"/>
                                                </p:column>
                                                <ui:remove>
                                                    <p:column headerText="#{BundleBDIntegrado.GsspSolicitudCese_dtVigilante_opcion}" style="text-align:center" 
                                                              exportable="false" >
                                                        <f:facet name="header">
                                                            <h:outputText value="#{BundleBDIntegrado.GsspSolicitudCese_dtVigilante_opcion}" />
                                                        </f:facet>
                                                        <p:commandButton update="@form"
                                                                        icon="ui-icon-trash"
                                                                        style="background: #ed1c24 !important"
                                                                        actionListener="#{sspCarneController.borrarFilaCese(item)}" 
                                                                        value="#{BundleBDIntegrado.Eliminar}" >
                                                            <p:confirm header="Confirmación" message="¿Está seguro de borrar el registro?" icon="ui-icon-alert" /> 
                                                       </p:commandButton>
                                                    </p:column>                                    
                                                </ui:remove>
                                            </p:dataTable>
                                            <br/>
                                            <div class="ui-g">
                                                  <div class="ui-g-12 ui-md-2 ui-lg-2"> 
                                                      <p:commandButton value="#{bundleGamac.EliminarSeleccionados_cmmb}" actionListener="#{sspCarneController.removerCarnesTemporal}"
                                                                       id="eliminarCarneMasivo"
                                                                       disabled="#{sspCarneController.lstVigilante eq null}"
                                                                       icon="ui-icon-closethick"
                                                                       process="@this, tableVigilantes" update="@this, eliminarCarneMasivo, tableVigilantes" >
                                                            <p:confirm header="Confirmación" message="¿Está seguro de borrar el(los) registro(s)?" icon="ui-icon-alert" />                                                                        
                                                       </p:commandButton>
                                                  </div>
                                                  <div class="ui-g-12 ui-md-10 ui-lg-10" style="display:none;"></div>
                                              </div> 
                                        </h:panelGrid>
                                    </p:panel>    
                                </p:tab>
                                <!--FIN DE PANEL DE SELECCION DE CARNE PARA CESE-->
                                <p:tab id="tab2" title="Errores de Carga Masiva por Cese">
                                    <p:panel class="panelTab"> 
                                        <h:panelGrid columns="1" style="border: 0px; width: 100%;" rendered="#{sspCarneController.lstObservacionCargaMasiva != null }" >
                                            <h:commandLink style="float: right; clear: both;">
                                                <p:graphicImage name="/icons/xls.png" width="32" alt="Excel"/>
                                                <p:dataExporter type="xls" target="tablaObservaCargaMasivaCarne" fileName="ObservacionesCargaCese" pageOnly="false" postProcessor="#{sspCarneController.postProcessXLS}"/>
                                            </h:commandLink>
                                        </h:panelGrid>
                                        <p:dataTable id="tablaObservaCargaMasivaCarne" value="#{sspCarneController.lstObservacionCargaMasiva}"
                                                         emptyMessage="#{BundleBDIntegrado.MensajeNoResultados}" var="item" 
                                                         paginator="true" rows="#{BundleBDIntegrado.PaginatorFilas}"  
                                                         paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink}
                                                         {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"  
                                                         rowsPerPageTemplate="#{BundleBDIntegrado.PaginatorFilasPorPagina}"
                                                         currentPageReportTemplate="{totalRecords} Observaciones">

                                                <p:column headerText="#{BundleBDIntegrado.GsspSolicitudCese_dtObservacionCargaMasiva}" >
                                                    <f:facet name="header">
                                                        <h:outputText value="#{BundleBDIntegrado.GsspSolicitudCese_dtObservacionCargaMasiva}" />
                                                    </f:facet>
                                                    <h:outputText value="#{item.observacion}"/>
                                                </p:column>
                                                <p:column headerText="#{BundleBDIntegrado.GsspSolicitudCese_dtNombreArchivoCargaMasiva}" >
                                                    <f:facet name="header">
                                                        <h:outputText value="#{BundleBDIntegrado.GsspSolicitudCese_dtNombreArchivoCargaMasiva}" />
                                                    </f:facet>
                                                    <h:outputText value="#{item.nombreArchivo}"/>
                                                </p:column>
                                            </p:dataTable>
                                    </p:panel>    
                                </p:tab>
                            </p:tabView>    
                            
                        </p:panel>
                        <br/>
                        
           
                        <br/>
                    </p:tab>
            </p:wizard>
        </h:form>
    <ui:include src="dlgCargaMasivaCese.xhtml" />
</ui:composition>

                

        
        