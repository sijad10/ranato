<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui">
    <ui:define name="title">
        <h:outputText value="#{bundleRenagi.BuscarDcGamacLicenciasTitulo}" rendered="#{dcGamacLicenciasRenagiController.estado == 'BUSCAR'}"/>
        <h:outputText value="#{bundleRenagi.VerDcGamacLicenciasTitulo}" rendered="#{dcGamacLicenciasRenagiController.estado == 'VER'}"/>
    </ui:define>
    <ui:define name="body">
        
        <div class="ui-fluid">
            <div class="ui-g">
                <div class="ui-g-12">
                    
                    <h:form id="buscarForm" rendered="#{dcGamacLicenciasRenagiController.estado == 'BUSCAR'}">
                        <p:focus context="buscarForm" />
                        <p:defaultCommand target="botonBuscar"/>
                        <p:panel id="buscarPanel" style="margin-bottom:10px;" toggleable="true" toggleSpeed="500" widgetVar="panel" >
                            <div class="ui-g">
                                <div class="ui-g-12 ui-md-4 ui-lg-2">
                                    <p:outputLabel id="buscarFiltro" value="#{bundleRenagi.Filtro}" />
                                    <p:selectOneMenu id="tipoId" value="#{dcGamacLicenciasRenagiController.tipo}" autoWidth="false" onchange="selectTipoFiltro()" >
                                        <f:selectItem itemValue="licencia" itemLabel="NRO LICENCIA"/>
                                        <f:selectItem itemValue="serie" itemLabel="NRO SERIE"/>
                                        <f:selectItem itemValue="doc_prop" itemLabel="DOC PROPIETARIO"/>
                                        <f:selectItem itemValue="nom_prop" itemLabel="NOMBRE PROPIETARIO"/>
                                        <ui:remove>
                                        <f:selectItem itemValue="doc_portador" itemLabel="DOC PORTADOR"/>
                                        <f:selectItem itemValue="nom_portador" itemLabel="NOMBRE PORTADOR"/>
                                        </ui:remove>
                                    </p:selectOneMenu>
                                </div>
                                <div class="ui-g-12 ui-md-3 ui-lg-2">
                                    <p:spacer />
                                    <p:inputText  value="#{dcGamacLicenciasRenagiController.filtro}" size="80" placeholder="#{bundleRenagi.PhCriterio}" required="true" requiredMessage="#{bundleRenagi.ErrorDatoBusquedaRequerido}"/>
                                </div>
                                <div class="ui-g-12 ui-md-3 ui-lg-1">
                                    <p:spacer />
                                    <p:commandButton id="botonBuscar" value="#{bundleRenagi.Buscar}" icon="ui-icon-search" oncomplete="completeFind();"
                                                     actionListener="#{dcGamacLicenciasRenagiController.buscar}" update=":buscarForm" />
                                </div>                                
                            </div>

                            <p:blockUI block="buscarPanel" trigger="botonBuscar" />
                        </p:panel>

                        <h:panelGroup id="buscarPanel33">
                            <ui:remove>
                                <h:panelGrid columns="4">
                                    <p:outputLabel id="buscarFiltro" value="#{bundleRenagi.Filtro}" />
                                    <p:selectOneMenu id="tipoId" value="#{dcGamacLicenciasRenagiController.tipo}" onchange="selectTipoFiltro()" >
                                        <f:selectItem itemValue="licencia" itemLabel="NRO LICENCIA DE POSESIÓN"/>
                                        <f:selectItem itemValue="serie" itemLabel="NRO SERIE"/>
                                        <f:selectItem itemValue="doc_prop" itemLabel="DOC PROPIETARIO"/>
                                        <f:selectItem itemValue="nom_prop" itemLabel="NOMBRE PROPIETARIO"/>
                                        <f:selectItem itemValue="doc_portador" itemLabel="DOC PORTADOR"/>
                                        <f:selectItem itemValue="nom_portador" itemLabel="NOMBRE PORTADOR"/>
                                    </p:selectOneMenu>
                                    <p:inputText id="filtroTexto" value="#{dcGamacLicenciasRenagiController.filtro}" size="80" placeholder="INGRESE NRO DE LICENCIA" required="true" requiredMessage="#{bundleRenagi.ErrorDatoBusquedaRequerido}"/>
                                    <p:commandButton id="botonBuscar" value="#{bundleRenagi.Buscar}" icon="ui-icon-search" actionListener="#{dcGamacLicenciasRenagiController.buscar}"  update=":buscarForm" />
                                </h:panelGrid>
                            </ui:remove>

                            <h:panelGroup rendered="#{dcGamacLicenciasRenagiController.resultados == null}">
                                <br/>
                                <h:outputLabel value="#{bundleRenagi.Instrucciones}" style="font-weight: bold"/><br/><br/>
                                <h:outputLabel value="#{bundleRenagi.InstruccionesGamacLicencias}" escape="false"/>
                            </h:panelGroup>

                            <h:panelGroup rendered="#{dcGamacLicenciasRenagiController.resultados != null}">
                                <h:panelGrid columns="2" style="border: 0px; width: 100%;">
                                    <h:outputLabel value="#{bundleRenagi.Resultados}" escape="false" />
                                    <h:commandLink style="float: right; clear: both;">
                                        <p:graphicImage name="/icons/xls.png" width="32" alt="#{bundleRenagi.ExportarExcel}"/>
                                        <p:dataExporter type="xls" target="buscarDatatable" fileName="BusquedaArmas" />
                                    </h:commandLink>
                                </h:panelGrid>
                                <p:dataTable id="buscarDatatable" value="#{dcGamacLicenciasRenagiController.resultados}"
                                             var="item"
                                             rowKey="#{item.id}"
                                             emptyMessage="#{bundleRenagi.MensajeNoResultados}" 
                                             paginator="true" rows="#{bundleRenagi.PaginatorFilas}"  
                                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"  
                                             rowsPerPageTemplate="#{bundleRenagi.PaginatorFilasPorPagina}"
                                             reflow="true">
                                    <p:column headerText="NRO LICENCIA DE POSESIÓN" sortBy="#{item.NRO_LIC}" style="font-size:95%!important" class="ui-lg-1">
                                        <h:outputText value="#{item.NRO_LIC}" rendered="#{item.SISTEMA=='DISCA'}"/>
                                    </p:column>
                                    <p:column headerText="#{bundleRenagi.DcGamacLicenciasTitle_DATOS_ARMA}" sortBy="#{item.TIPO_ARMA} #{item.MARCA} #{item.MODELO} #{item.CALIBRE}" style="font-size:95%!important" class="ui-lg-2">
                                        <f:facet name="header">
                                            <h:outputText value="#{bundleRenagi.DcGamacLicenciasTitle_DATOS_ARMA}" />
                                        </f:facet>

                                        <h:outputText value="#{item.TIPO_ARMA} #{item.MARCA} #{item.MODELO} #{item.CALIBRE}"/>
                                    </p:column>
                                    <p:column headerText="#{bundleRenagi.DcGamacLicenciasTitle_NRO_SERIE}" sortBy="#{item.NRO_SERIE}" style="font-size:95%!important" class="ui-lg-1">
                                        <f:facet name="header">
                                            <h:outputText value="#{bundleRenagi.DcGamacLicenciasTitle_NRO_SERIE}" />
                                        </f:facet>

                                        <h:outputText value="#{item.NRO_SERIE}"/>
                                    </p:column>
                                    <p:column headerText="#{bundleRenagi.DcGamacLicenciasTitle_FEC_EMISION}" sortBy="#{item.FEC_EMISION}" style="font-size:95%!important" class="ui-lg-1">
                                        <f:facet name="header">
                                            <h:outputText value="#{bundleRenagi.DcGamacLicenciasTitle_FEC_EMISION}" />
                                        </f:facet>
                                        <h:outputText value="#{item.FEC_EMISION}">
                                            <f:converter converterId="fechaConverter" />
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="#{bundleRenagi.DcGamacLicenciasTitle_FEC_VENCIMIENTO}" sortBy="#{item.FEC_VENCIMIENTO}" style="font-size:95%!important" class="ui-lg-1">
                                        <f:facet name="header">
                                            <h:outputText value="#{bundleRenagi.DcGamacLicenciasTitle_FEC_VENCIMIENTO}" />
                                        </f:facet>
                                        <h:outputText value="#{item.FEC_VENCIMIENTO}">
                                            <f:converter converterId="fechaConverter" />
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="#{bundleRenagi.DcGamacLicenciasTitle_PROPIETARIO}" sortBy="#{item.PROPIETARIO}" style="font-size:95%!important" class="ui-lg-2">
                                        <f:facet name="header">
                                            <h:outputText value="#{bundleRenagi.DcGamacLicenciasTitle_PROPIETARIO}" />
                                        </f:facet>

                                        <h:outputText value="#{item.PROPIETARIO != null ? item.PROPIETARIO : 'S/N'} - #{item.DOC_PROPIETARIO}"/>
                                    </p:column>
                                    <ui:remove>
                                    <p:column headerText="#{bundleRenagi.DcGamacLicenciasTitle_PORTADOR}" sortBy="#{item.PORTADOR}" style="font-size:95%!important" class="ui-lg-2">
                                        <f:facet name="header">
                                            <h:outputText value="#{bundleRenagi.DcGamacLicenciasTitle_PORTADOR}" />
                                        </f:facet>

                                        <h:outputText value="#{item.PORTADOR != null ? item.PORTADOR : 'S/N'} - #{item.DOC_PORTADOR}"/>
                                    </p:column>
                                    </ui:remove>
                                    <p:column headerText="#{bundleRenagi.DcGamacLicenciasTitle_SITUACION}" sortBy="#{item.SITUACION}" style="font-size:95%!important" class="ui-lg-1">
                                        <f:facet name="header">
                                            <h:outputText value="#{bundleRenagi.DcGamacLicenciasTitle_SITUACION}" />
                                        </f:facet>

                                        <h:outputText value="#{item.SITUACION}"/>
                                    </p:column>
                                    <p:column headerText="#{bundleRenagi.DcGamacLicenciasTitle_ESTADO}" sortBy="#{item.ESTADO}" style="font-size:95%!important">
                                        <f:facet name="header">
                                            <h:outputText value="#{bundleRenagi.DcGamacLicenciasTitle_ESTADO}" />
                                        </f:facet>

                                        <h:outputText value="#{item.ESTADO}"/>
                                    </p:column>
                                    <ui:remove>
                                    <p:column headerText="#{bundleRenagi.Ver}" exportable="false" width="4%">
                                        <p:commandLink actionListener="#{dcGamacLicenciasRenagiController.mostrarVer}" value="#{bundleRenagi.Ver}" process="@this" partialSubmit="true" update="@all" ajax="true"/>
                                        <h:outputText value=" "/>
                                    </p:column>
                                    </ui:remove>
                                    <p:column headerText="OPCIÓN" exportable="false" style="font-size:95%!important; text-align: right;" class="ui-lg-1">
                                        <ui:remove>
                                        <p:commandLink actionListener="#{dcGamacLicenciasController.mostrarVer}" value="VER" process="@this" partialSubmit="true" update="@all" ajax="true"/>
                                        <h:outputText value=" "/>
                                        </ui:remove>
                                        <div class="ui-row-editor ui-helper-clearfix ui-toolbar-group-right" style="padding: 0!important">
                                            <p:commandLink  id="botonDocumento" 
                                                             ajax="false" 
                                                             partialSubmit="true"                              
                                                             immediate="true" target="_blank" >
                                                <p:fileDownload value="#{dcGamacLicenciasRenagiController.reporte(item)}" contentDisposition="inline" />
                                                <h:outputText styleClass="ui-icon ui-icon-print" style="margin:0 auto;" />
                                            </p:commandLink>                                                
                                            <p:commandLink id="ajax" actionListener="#{dcGamacLicenciasRenagiController.mostrarVerDlg(item)}" style="font-size:95%!important" >
                                                <h:outputText styleClass="ui-icon ui-icon-search" style="margin:0 auto;" />                                            
                                            </p:commandLink>
                                        </div>
                                    </p:column>                                 
                                    
                                </p:dataTable>
                            </h:panelGroup>

                        </h:panelGroup>
                    </h:form>

                </div>
            </div>
        </div>    
        <ui:include src="View.xhtml" />
        <ui:include src="DlgViewDisca.xhtml" />
        <ui:include src="DlgViewGamac.xhtml" />
        
        <script type="text/javascript">
            function selectTipoFiltro() {
                switch ($("select[id*='tipoId']").val()) {
                    case "licencia":
                        $("input[id*='filtroTexto']").attr("placeholder", "INGRESE NRO DE LICENCIA");
                        break;
                    case "serie":
                        $("input[id*='filtroTexto']").attr("placeholder", "INGRESE NRO DE SERIE");
                        break;
                    case "doc_prop":
                        $("input[id*='filtroTexto']").attr("placeholder", "INGRESE DOC PROPIETARIO");
                        break;
                    case "nom_prop":
                        $("input[id*='filtroTexto']").attr("placeholder", "INGRESE APELLIDOS Y NOMBRES DEL PROPIETARIO");
                        break;
                    case "doc_portador":
                        $("input[id*='filtroTexto']").attr("placeholder", "INGRESE DOC PORTADOR");
                        break;
                    case "nom_portador":
                        $("input[id*='filtroTexto']").attr("placeholder", "INGRESE APELLIDOS Y NOMBRES DEL PORTADOR");
                        break;
                }                
            }
            
            function completeFind(){
                $("div[id*='buscarPanel_content']").attr("style", "padding:0!important");
            }

            $(document).ready(function() { 
                //$(".ui-dialog-titlebar").attr("style", "padding:8px!important; margin:0!important");
                $(".txtLabel").parent().attr("style", "padding-top:11px");
                $(".ui-layout-unit-header").attr("style", "border: 1px solid #1f89ce; color: #fff; background: #2399e5;");
                $(".ui-state-disabled").attr("style", "opacity: .80; filter: Alpha(Opacity=80); background-image: none;");
                $("textarea:disabled").attr("style", "opacity: .80; filter: Alpha(Opacity=80); background-image: none; background-color:#EEEEEE");
                $("select:disabled").parent().parent().children("label, .ui-selectonemenu-trigger").attr("style", "opacity: .80; filter: Alpha(Opacity=80); background-image: none; background-color:#EEEEEE");

                $("div[id*='buscarPanel_content']").attr("style", "padding:0px!important");

            });
            
        </script>
    </ui:define>
</ui:composition>

