<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui">
    <ui:define name="title">
        <h:outputText value="Búsqueda de licencias de armas y Tarjeta de Propiedad" rendered="#{gamacConstanciaLicTarController.estado == 'BUSCAR'}"/>
        <h:outputText value="#{bundleRenagi.VerGamacConstanciaLicTarTitulo}" rendered="#{gamacConstanciaLicTarController.estado == 'VER'}"/>
    </ui:define>
    <ui:define name="body">
        
        <div class="ui-fluid">
            <div class="ui-g">
                <div class="ui-g-12">
                    
                    <h:form id="buscarForm" rendered="#{gamacConstanciaLicTarController.estado == 'BUSCAR'}">
                        <p:focus context="buscarForm" />
                        <p:defaultCommand target="botonBuscar"/>

                        <p:panel id="buscarPanel" header="Búsqueda de propietarios de armas" style="margin-bottom:10px;" toggleable="true" toggleSpeed="500" widgetVar="panel" >
                            <div class="ui-g">
                                <div class="ui-g-12 ui-md-6 ui-lg-1">
                                    <p:outputLabel id="buscarFiltro" value="Tipo de Filtro" />
                                </div>
                                <div class="ui-g-12 ui-md-6 ui-lg-1">
                                    <p:selectOneMenu id="tipoId" value="#{gamacConstanciaLicTarController.tipo}" >
                                        <f:selectItem itemValue="dni" itemLabel="DNI"/>
                                        <f:selectItem itemValue="ce" itemLabel="CE"/>
                                        <f:selectItem itemValue="cip" itemLabel="CIP"/>                                        
                                        <f:selectItem itemValue="ruc" itemLabel="RUC"/>
                                        <f:selectItem itemValue="lic" itemLabel="NRO LICENCIA"/>
                                        <f:selectItem itemValue="ape" itemLabel="APELLIDO(S)"/>
                                    </p:selectOneMenu>
                                </div>
                                <div class="ui-g-12 ui-md-6 ui-lg-2">
                                    <p:inputText value="#{gamacConstanciaLicTarController.filtro}" size="20" placeholder="#{bundleRenagi.PhCriterio}" autocomplete="false"
                                                 required="true" requiredMessage="#{bundleRenagi.ErrorDatoBusquedaRequerido}"/>                                    
                                </div>
                                <div class="ui-g-12 ui-md-6 ui-lg-2">
                                    <p:commandButton id="botonBuscar" value="#{bundleRenagi.Buscar}" icon="ui-icon-search" actionListener="#{gamacConstanciaLicTarController.buscar}" 
                                                     update=":buscarForm:pnlDataTable" oncomplete="completeFind();" />                                    
                                </div>                                
                            </div>
                            <p:blockUI block="buscarPanel" trigger="botonBuscar" />
                        </p:panel>
                        
                        <h:panelGroup id="pnlDataTable" >
                            <h:panelGroup rendered="#{gamacConstanciaLicTarController.resultados != null}">
                                <h:panelGrid columns="2" style="border: 0px; width: 100%;">
                                    <h:outputLabel value="#{bundleRenagi.Resultados}" escape="false" />
                                    <h:commandLink style="float: right; clear: both;">
                                        <p:graphicImage name="/icons/xls.png" width="32" alt="#{bundleRenagi.ExportarExcel}"/>
                                        <p:dataExporter type="xls" target="buscarDatatable" fileName="BusquedaArmas" />
                                    </h:commandLink>
                                </h:panelGrid>
                                <p:dataTable id="buscarDatatable" value="#{gamacConstanciaLicTarController.resultados}"
                                             var="item"
                                             rowKey="#{item.DOC_PROPIETARIO}"
                                             emptyMessage="#{bundleRenagi.MensajeNoResultados}" 
                                             paginator="true" rows="#{bundleRenagi.PaginatorFilas}"  
                                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"  
                                             rowsPerPageTemplate="#{bundleRenagi.PaginatorFilasPorPagina}"
                                             rowIndexVar="idDni"
                                             reflow="true"
                                             >
                                    
                                    <p:column headerText="TIPO DOC" sortBy="#{item.TIPO_DOC}" style="font-size:96%!important" class="ui-lg-1">
                                        <h:outputText value="#{item.TIPO_DOC}"/>
                                        <h:inputHidden id="rowDni" value="#{item.TIPO_DOC}"/>
                                    </p:column>
                                    <p:column headerText="DOC PROPIETARIO" sortBy="#{item.DOC_PROPIETARIO}" style="font-size:96%!important" class="ui-lg-1">

                                        <h:outputText value="#{item.DOC_PROPIETARIO}"/>
                                        <h:inputHidden id="rowNumDoc" value="#{item.DOC_PROPIETARIO}"/>
                                    </p:column>
                                    <p:column headerText="PROPIETARIO" sortBy="#{item.NRO_SERIE}" style="font-size:96%!important" class="ui-lg-9">
                                        <h:outputText value="#{item.PROPIETARIO}"/>
                                    </p:column>
                                    <p:column headerText="DOCUMENTO" exportable="false" style="font-size:96%!important; text-align: right;" class="ui-lg-1">
                                        <p:commandLink actionListener="#{gamacConstanciaLicTarController.validaPersona(item)}" ajax="true">
                                            <p:graphicImage name="/icons/printVer.png" width="52" alt="Imprimir contancia"/>
                                        </p:commandLink>
                                        <h:commandLink target="_blank" class="verificaDoc#{item.DOC_PROPIETARIO} ui-helper-hidden">
                                            <p:graphicImage name="/icons/printVer.png" width="52" alt="Imprimir contancia"/>
                                            <p:fileDownload value="#{gamacConstanciaLicTarController.reporte(item, item.TIPO_DOC, item.DOC_PROPIETARIO)}" contentDisposition="inline"  />
                                        </h:commandLink>                                        
                                    </p:column>
                                    <ui:remove>
                                    <p:column headerText="OPCIÓN" exportable="false" style="font-size:95%!important; text-align: right;" class="ui-lg-1">
                                        <p:commandLink id="ajax" actionListener="#{gamacConstanciaLicTarController.mostrarVerDlg(item)}" value="VER" style="font-size:95%!important" />
                                        <h:outputText value=" "/>
                                    </p:column>                                 
                                    </ui:remove>

                                    <!--
                                    <p:column headerText="#{bundleRenagi.Ver}" exportable="false" width="4%">
                                        <p:commandLink actionListener="#{gamacConstanciaLicTarController.mostrarVer}" value="#{bundleRenagi.Ver}" process="@this" partialSubmit="true" update="@all" ajax="true"/>
                                        <h:outputText value=" "/>
                                    </p:column>
                                    -->
                                </p:dataTable>
                            </h:panelGroup>

                        </h:panelGroup>
                    </h:form>

                </div>        
            </div>
        </div>    
        <ui:include src="View.xhtml" />
        <ui:include src="DlgViewDisca.xhtml" />
        <ui:include src="DlgViewGamac.xhtml" />        
        
        <script type="text/javascript">
            $(".tipo1").show();
            $(".txtLabel").parent().attr("style", "padding-top:11px");
            //$(".ui-dialog-titlebar").attr("style", "padding:8px!important; margin:0!important");
            $(".ui-layout-unit-header").attr("style", "border: 1px solid #1f89ce; color: #fff; background: #2399e5;");
            $("div[id*='buscarPanel_content']").attr("style", "padding:0!important");

            function completeFind(){
                $("div[id*='buscarPanel_content']").attr("style", "padding:0!important");                
            }

        </script>
        
    </ui:define>
</ui:composition>

