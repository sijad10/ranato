<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui" >
    
    <ui:composition template="/template.xhtml"> 
        <ui:define name="title">
            <h:outputText value="#{bundleGeppGte.BuscarEppLicenciaTitulo}" />
        </ui:define>
        <ui:define name="body">            
            <h:form id="buscarForm" >
                <p:panel header="Busqueda" id="panBusqueda" >

                    <h:panelGrid columns="1" >
                        <p:fieldset legend="#{bundleGeppGte.EppLicencia_criterioBusq}" >
                            <h:panelGrid columns="5" id="pnlgBusqueda">                     
                                <p:outputLabel value="#{bundleGeppGte.EppLicencia_buscarpor}" for="bus"/> 
                                <p:selectOneMenu id="bus" value="#{eppRegistroGuiaTransitoController.tipoBusqueda}"  >
                                    <f:selectItem itemValue="#{null}" itemLabel="------"/>                                    
                                    <f:selectItem itemValue="1" itemLabel="NOMBRES Y APELLIDOS" />
                                    <f:selectItem itemValue="2" itemLabel="NRO. LICENCIA" />
                                    <p:ajax event="change" update="@this,pnlgBusqueda" listener="#{eppRegistroGuiaTransitoController.cambiaTipoBusquedaLME()}" />
                                </p:selectOneMenu>
                                <p:inputText value="#{eppRegistroGuiaTransitoController.filtro}" id="filtroBusqueda" maxlength="#{eppRegistroGuiaTransitoController.maxLength}" />
                                <p:commandButton value="#{bundleGeppGte.Buscar}" 
                                                 process="@this,pnlgBusqueda"
                                                 icon="ui-icon-search " actionListener="#{eppRegistroGuiaTransitoController.buscarBandejaLME()}" 
                                                 update="@form"/>       
                            </h:panelGrid>
                        </p:fieldset>
                    </h:panelGrid>

                    <p:dataTable id="buscarDatatableRegistro" value="#{eppRegistroGuiaTransitoController.resultadosLME}"
                                 var="itemReg"                                  
                                 emptyMessage="#{bundleGeppGte.MensajeNoResultados}" 
                                 paginator="true" rows="#{bundleGeppGte.PaginatorFilas}"  
                                 paginatorTemplate="{CurrentPageReport}  {FirstPageLink} 
                                 {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} 
                                 {RowsPerPageDropdown}"  
                                 rowsPerPageTemplate="#{bundleGeppGte.PaginatorFilasPorPagina}">
                        <p:column headerText="#{bundleGeppGte.EppLicencia_dtBandeja_id}" sortBy="#{itemReg.id}" style="text-align:center;" >                               
                            <h:outputText value="#{itemReg.id}" />
                        </p:column>
                        <p:column headerText="#{bundleGeppGte.EppLicencia_dtBandeja_exp}" style="text-align:center;" >
                            <h:outputText value="#{itemReg.nroExpediente}"/><br/>
                        </p:column>
                        <p:column headerText="#{bundleGeppGte.EppLicencia_dtBandeja_fechaReg}" style="text-align:center;">
                            <h:outputText value="#{itemReg.fecha}">
                                <f:convertDateTime pattern="#{bundleGeppGte.FormatoFecha}" />
                            </h:outputText>
                        </p:column>
                        <p:column headerText="#{bundleGeppGte.EppLicencia_dtBandeja_nroLicencia}" style="text-align:center;">                                
                            <h:outputText value="#{eppRegistroGuiaTransitoController.obtenerNroLicencia(itemReg) } "/><br/>
                        </p:column>
                        <p:column headerText="#{bundleGeppGte.EppLicencia_dtBandeja_ape}" style="text-align:center;">                                
                            <h:outputText value="#{eppRegistroGuiaTransitoController.obtenerDatosLicencia(itemReg) } "/><br/>
                        </p:column>
                        <p:column headerText="#{bundleGeppGte.EppLicencia_dtBandeja_rznSocial}" style="text-align:center;">                                
                            <h:outputText value="#{itemReg.empresaId.rznSocial == null ? itemReg.empresaId.nombreCompleto : itemReg.empresaId.rznSocial } "/><br/>
                        </p:column>
                        <p:column headerText="#{bundleGeppGte.EppLicencia_dtBandeja_tipoDoc}" style="text-align:center;">                            
                            <h:outputText value="#{itemReg.empresaId.tipoDoc.nombre}"/> <br/>
                            <h:outputText value="#{itemReg.empresaId.ruc == null ?  itemReg.empresaId.numDoc : itemReg.empresaId.ruc} "  /> 
                        </p:column>
                        <p:column headerText="#{bundleGeppGte.EppLicencia_dtBandeja_tipoPro}" style="text-align:center;">                                
                            <h:outputText value="#{itemReg.tipoProId.abreviatura}" />   <br/>
                            <h:outputText value="#{itemReg.tipoOpeId.nombre}" />                           
                        </p:column>
                        <p:column headerText="#{bundleGeppGte.EppLicencia_dtBandeja_vigencia}" style="text-align:center;">                               
                            <h:outputText value="#{eppRegistroGuiaTransitoController.obtenerDescVigencia(itemReg)}"/><br/>
                            <b><h:outputText value="Fecha Ini: "/></b>
                            <h:outputText value="#{eppRegistroGuiaTransitoController.obtenerFechaLicencia(itemReg,1)}">
                                <f:convertDateTime pattern="#{bundleGeppGte.FormatoFecha}" />
                            </h:outputText><br/>
                            <b><h:outputText value="Fecha Fin: "/></b>
                            <h:outputText value="#{eppRegistroGuiaTransitoController.obtenerFechaLicencia(itemReg,2)}">
                                <f:convertDateTime pattern="#{bundleGeppGte.FormatoFecha}" />
                            </h:outputText>
                        </p:column>
   
                    </p:dataTable>
                </p:panel>                    
            </h:form>
        </ui:define>
    </ui:composition>
</html>
